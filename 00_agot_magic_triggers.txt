agot_is_world_magic_trigger = {
	global_var:magic_level > 0
}

agot_dragon_dream_scheme_discovery_trigger = {
	is_scheme_exposed = no
	exists = scope:target.host
	NOT = { scope:target.host = scope:owner }
	OR = {
		scope:target = {
			OR = {
				has_character_flag = dragon_dreams
				has_trait = dragon_dreams
			}
			NOT = { has_character_flag = dreamt }
		}
		scope:target = {
			any_close_or_extended_family_member = {
				age > 5
				OR = {
					has_character_flag = dragon_dreams
					has_trait = dragon_dreams
				}
				NOT = { this = scope:owner }
				NOT = { has_character_flag = dreamt }
				save_temporary_opinion_value_as = {
					name = opinion_of_target
					target = scope:target
				}
				scope:opinion_of_target >= 0
			}
		}
	}
}

agot_greensight_scheme_discovery_trigger = {
	is_scheme_exposed = no
	exists = scope:target.host
	NOT = { scope:target.host = scope:owner }
	OR = {
		scope:target = {
			OR = {
				has_character_flag = greensight
				has_trait = greensight
			}
			NOT = { has_character_flag = foreseen }
		}
		scope:target = {
			any_close_or_extended_family_member = {
				age > 5
				OR = {
					has_character_flag = greensight
					has_trait = greensight
				}
				NOT = { this = scope:owner }
				NOT = { has_character_flag = foreseen }
				save_temporary_opinion_value_as = {
					name = opinion_of_target
					target = scope:target
				}
				scope:opinion_of_target >= 0
			}
		}
	}
}

# Checks if a harm event can be blocked via dragon dreams/greensight
agot_prevent_harm_event_with_foresight_trigger = {
	trigger_if = {  # The player has a foresight trait
		limit = {
			age >= 5
			OR = {
				has_trait = dragon_dreams
				has_trait = greensight
			}
		}
	}
	trigger_else = {  # Someone who would warn the player has a foresight trait
		OR = {
			any_close_or_extended_family_member = {
				count > 0
				OR = {
					has_trait = dragon_dreams
					has_trait = greensight
				}
				scope_is_close_to_root_trigger = yes
				opinion = {
					target = root
					value >= neutral_opinion
				}
			}
			any_relation = {
				count > 0
				type = friend
				age >= 5
				OR = {
					has_trait = dragon_dreams
					has_trait = greensight
				}
				scope_is_close_to_root_trigger = yes
			}
			any_relation = {
				count > 0
				type = best_friend
				age >= 5
				OR = {
					has_trait = dragon_dreams
					has_trait = greensight
				}
				scope_is_close_to_root_trigger = yes
			}
			any_relation = {
				count > 0
				type = lover
				age >= 5
				OR = {
					has_trait = dragon_dreams
					has_trait = greensight
				}
				scope_is_close_to_root_trigger = yes
			}
			any_relation = {
				count > 0
				type = soulmate
				age >= 5
				OR = {
					has_trait = dragon_dreams
					has_trait = greensight
				}
				scope_is_close_to_root_trigger = yes
			}
			any_relation = {
				count > 0
				type = paramour
				age >= 5
				OR = {
					has_trait = dragon_dreams
					has_trait = greensight
				}
				scope_is_close_to_root_trigger = yes
			}
		}
	}
}