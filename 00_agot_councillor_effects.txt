
#####################################################################
# EFFECT LIST
#####################################################################

#####################################################################
# PERSONAL STEWARD COUNCILLOR EFFECTS
#####################################################################

agot_councillor_personal_steward_learning_2601_tutoring_effect = {
	$STUDENT$ = { save_scope_as = tutoring_student }
	scope:tutoring_student = {
		random_list = {
			20 = { #Critical success
				modifier = {
					has_education_rank_trigger = { RANK = 3 OPERATOR = equals }
					factor = 0.6
				}
				modifier = {
					has_education_rank_trigger = { RANK = 4 OPERATOR = equals }
					factor = 0.6
				}
				modifier = {
					root = { personal_steward_learning_tier_3_trigger = yes }
					factor = 1.5
				}
				desc = agot_councillor_personal_steward_learning_2601_tutoring_effect.critical_success
				root = {
					send_interface_toast = {
						title = agot_councillor_personal_steward_learning_2601_tutoring_effect.critical_success
						left_icon = scope:tutoring_student
						right_icon = scope:councillor
						scope:tutoring_student = {
							rank_up_education_effect = yes
						}
					}
					add_character_flag = {
						flag = had_councillor_personal_steward_learning_2601_event
						days = 7300
					}
				}

				hidden_effect = {
					scope:tutoring_student = {
						add_opinion = {
							target = scope:councillor
							modifier = grateful_opinion
							opinion = 15
						}
					}
					scope:councillor = {
						if = {
							limit = { scope:tutoring_student = { has_trait = education_diplomacy } }
							add_character_modifier = {
								modifier = studying_diplomacy
								years = 10
							}
						}
						else_if = {
							limit = { scope:tutoring_student = { has_trait = education_martial } }
							add_character_modifier = {
								modifier = studying_martial
								years = 10
							}
						}
						else_if = {
							limit = { scope:tutoring_student = { has_trait = education_stewardship } }
							add_character_modifier = {
								modifier = studying_stewardship
								years = 10
							}
						}
						else_if = {
							limit = { scope:tutoring_student = { has_trait = education_intrigue } }
							add_character_modifier = {
								modifier = studying_intrigue
								years = 10
							}
						}
						else_if = {
							limit = { scope:tutoring_student = { has_trait = education_learning } }
							add_character_modifier = {
								modifier = studying_learning
								years = 10
							}
						}
						random_list = {
							1 = { set_nickname_effect = { NICKNAME = nick_the_scholar } }
							1 = { set_nickname_effect = { NICKNAME = nick_the_wise } }
							10 = { }
						}
					}
				}
			}
			55 = { #Success
				desc = agot_councillor_personal_steward_learning_2601_tutoring_effect.success
				root = {
					send_interface_toast = {
						title = agot_councillor_personal_steward_learning_2601_tutoring_effect.success
						left_icon = scope:tutoring_student
						right_icon = scope:councillor
						scope:tutoring_student = {
							if = {
								limit = { has_trait = education_diplomacy }
								add_character_modifier = {
									modifier = studying_diplomacy
									years = 10
								}
							}
							else_if = {
								limit = { has_trait = education_martial }
								add_character_modifier = {
									modifier = studying_martial
									years = 10
								}
							}
							else_if = {
								limit = { has_trait = education_stewardship }
								add_character_modifier = {
									modifier = studying_stewardship
									years = 10
								}
							}
							else_if = {
								limit = { has_trait = education_intrigue }
								add_character_modifier = {
									modifier = studying_intrigue
									years = 10
								}
							}
							else_if = {
								limit = { has_trait = education_learning }
								add_character_modifier = {
									modifier = studying_learning
									years = 10
								}
							}
							add_character_flag = {
								flag = had_councillor_personal_steward_learning_2601_event
								days = 3650
							}
						}
					}
				}
				hidden_effect = {
					scope:tutoring_student = {
						add_opinion = {
							target = scope:councillor
							modifier = grateful_opinion
							opinion = 10
						}
					}
				}
			}
		}
	}
}

agot_councillor_personal_steward_learning_2603_scopes_for_portraits_support_effect = {
	if = {
		limit = { exists = scope:councillor_2 }
		save_scope_as = councillor_3
	}
	else_if = {
		limit = { exists = scope:councillor_1 }
		save_scope_as = councillor_2
	}
	else = {
		save_scope_as = councillor_1
	}
}

agot_councillor_personal_steward_learning_2603_scopes_for_portraits_effect = {
	if = {
		limit = { is_ai = no }

		#Saves the (up to) 3 chosen chancellors for portraits. Set up like this to make sure the options and portraits are in the same order.
		if = {
			limit = { exists = scope:chancellor }
			scope:chancellor = { agot_councillor_personal_steward_learning_2603_scopes_for_portraits_support_effect = yes }
		}
		if = {
			limit = { exists = scope:marshal }
			scope:marshal = { agot_councillor_personal_steward_learning_2603_scopes_for_portraits_support_effect = yes }
		}
		if = {
			limit = { exists = scope:steward }
			scope:steward = { agot_councillor_personal_steward_learning_2603_scopes_for_portraits_support_effect = yes }
		}
		if = {
			limit = { exists = scope:spymaster }
			scope:spymaster = { agot_councillor_personal_steward_learning_2603_scopes_for_portraits_support_effect = yes }
		}
		if = {
			limit = { exists = scope:court_chaplain }
			scope:court_chaplain = { agot_councillor_personal_steward_learning_2603_scopes_for_portraits_support_effect = yes }
		}
	}
}

agot_councillor_personal_steward_learning_2603_scope_save_effect = {
	if = {
		limit = {
			any_normal_councillor = {
				councillor_personal_steward_learning_2603_valid_councillor_trigger = yes
				NOR = {
					AND = {
						exists = scope:chancellor
						this = scope:chancellor
					}
					AND = {
						exists = scope:marshal
						this = scope:marshal
					}
					AND = {
						exists = scope:steward
						this = scope:steward
					}
					AND = {
						exists = scope:spymaster
						this = scope:spymaster
					}
					AND = {
						exists = scope:court_chaplain
						this = scope:court_chaplain
					}
				}
			}
		}
		random_list = {
			1 = {
				trigger = {
					exists = cp:councillor_chancellor
					cp:councillor_chancellor = { councillor_personal_steward_learning_2603_valid_councillor_trigger = yes }
					NOT = { exists = scope:chancellor }
				}
				modifier = {
					cp:councillor_chancellor = { diplomacy <= mediocre_skill_rating }
					factor = 3
				}
				cp:councillor_chancellor = { save_scope_as = chancellor }
			}
			1 = {
				trigger = {
					exists = cp:councillor_marshal
					cp:councillor_marshal = { councillor_personal_steward_learning_2603_valid_councillor_trigger = yes }
					NOT = { exists = scope:marshal }
				}
				modifier = {
					cp:councillor_marshal = { martial <= mediocre_skill_rating }
					factor = 3
				}
				cp:councillor_marshal = { save_scope_as = marshal }
			}
			1 = {
				trigger = {
					exists = cp:councillor_steward
					cp:councillor_steward = { councillor_personal_steward_learning_2603_valid_councillor_trigger = yes }
					NOT = { exists = scope:steward }
				}
				modifier = {
					cp:councillor_steward = { stewardship <= mediocre_skill_rating }
					factor = 3
				}
				cp:councillor_steward = { save_scope_as = steward }
			}
			1 = {
				trigger = {
					exists = cp:councillor_spymaster
					cp:councillor_spymaster = { councillor_personal_steward_learning_2603_valid_councillor_trigger = yes }
					NOT = { exists = scope:spymaster }
				}
				modifier = {
					cp:councillor_spymaster = { intrigue <= mediocre_skill_rating }
					factor = 3
				}
				cp:councillor_spymaster = { save_scope_as = spymaster }
			}
			1 = {
				trigger = {
					exists = cp:councillor_court_chaplain
					cp:councillor_court_chaplain = { councillor_personal_steward_learning_2603_valid_councillor_trigger = yes }
					NOT = { exists = scope:court_chaplain }
				}
				modifier = {
					cp:councillor_court_chaplain = { learning <= mediocre_skill_rating }
					factor = 3
				}
				cp:councillor_court_chaplain = { save_scope_as = court_chaplain }
			}
		}
	}
}

agot_councillor_personal_steward_learning_2603_chosen_councillor_effect = {
	if = {
		limit = {
			OR = {
				has_trait = humble
				has_trait = calm
				has_trait = diligent
				has_trait = trusting
				has_trait = compassionate
				has_trait = forgiving
				has_trait = content
			}
			NOT = {
				has_trait = arrogant
			}
		}
		add_opinion = {
			target = root
			modifier = grateful_opinion
			opinion = 15
		}
		hidden_effect = {
			add_opinion = {
				target = scope:councillor
				modifier = grateful_opinion
				opinion = 15
			}
		}
	}
	else = {
		add_opinion = {
			target = root
			modifier = insult_opinion
			opinion = -15
		}
	}
}

agot_add_clergy_trait_effect = {
	if = {
		limit = {
			faith = { religion_tag = the_seven_religion }
		}
		add_trait = septon
	}
	else_if = {
		limit = {
			faith = { religion_tag = the_ways_religion }
		}
		add_trait = drowned_man
	}
	else_if = {
		limit = {
			faith = { religion_tag = the_rhllor_religion }
		}
		add_trait = red_priest
	}
}

agot_got_council_position_clergy_effect = {
	if = {
		limit = {
			save_temporary_scope_as = potential_clergy
			OR = {
				faith = {
					has_doctrine_parameter = clerical_appointment_fixed
					has_doctrine_parameter = clerical_appointment_head_of_faith
				}
				AND = {
					is_ruler = no
					is_married = no
					NOT = { has_trait = cynical }
					OR = {
						is_lowborn = yes
						dynasty = {
							dynasty_prestige_level <= 1
							any_dynasty_member = {
								count = 1
							}
						}
					}
				}
			}
		}
		agot_add_clergy_trait_effect = yes
	}

	#If there is a fired opinion remove it
	if = {
		limit = {
			exists = liege
			has_opinion_modifier = {
				modifier = fired_from_council_opinion
				target = liege
			}
		}
		remove_opinion = {
			modifier = fired_from_council_opinion
			target = liege
		}
	}
}