agot_init_magic_level_effect = {
	if = {
		limit = {
			agot_is_any_dragon_alive = no
		}
		set_global_variable = {
			name = magic_level
			value = 0 # no magic
		}
	}
	else_if = {
		limit = {
			any_in_global_list = {
				variable = living_dragons
				count < 10
			}
		}

		set_global_variable = {
			name = magic_level
			value = 1 # some magic
		}
	}
	else = {
		set_global_variable = {
			name = magic_level
			value = 2 # more magic
		}
	}
}

agot_dragon_birth_magic_effect = {
	if = {
		limit = {
			any_in_global_list = {
				variable = living_dragons
				count = 1
			}
		}
		set_global_variable = {
			name = magic_level
			value = 1
		}

		agot_update_glass_candles_effect = yes
		agot_dragon_revival_effect = yes
	}
	else_if = {
		limit = {
			any_in_global_list = {
				variable = living_dragons
				count = 10
			}
			NOT = { global_var:magic_level = 2 }
		}
		set_global_variable = {
			name = magic_level
			value = 2
		}
		agot_update_glass_candles_effect = yes
	}
}

agot_dragon_death_magic_effect = {
	if = {
		limit = { # I don't know if the dragon is still counted as alive, but it looks like it
			any_in_global_list = {
				variable = living_dragons
				count = 1
			}
		}
		set_global_variable = {
			name = magic_level
			value = 0
		}
		agot_update_glass_candles_effect = yes
		agot_dragon_extinction_effect = yes
	}
	else_if = {
		limit = {
			OR = {
				NOT = { exists = global_var:magic_level }
				NOT = { global_var:magic_level = 2 }
			}
			any_in_global_list = {
				variable = living_dragons
				NOT = { this = root }
				count < 10
			}
		}
		set_global_variable = {
			name = magic_level
			value = 1
		}
		agot_update_glass_candles_effect = yes
	}
	else_if = {
		limit = {
			exists = global_var:magic_level
			OR = {
				NOT = { exists = global_var:magic_level }
				NOT = { global_var:magic_level = 2 }
			}
		}
		set_global_variable = {
			name = magic_level
			value = 2
		}
		agot_update_glass_candles_effect = yes
	}
	if = {
		limit = {
			is_target_in_global_variable_list = {
				name = living_dragons
				target = root
			}
		}
		remove_list_global_variable = {
			name = living_dragons
			target = root
		}
	}
}