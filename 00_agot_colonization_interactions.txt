return_settlement_county_to_wilderness = {
	category = interaction_category_uncategorized
	hidden = yes

	desc = return_settlement_county_to_wilderness_desc

	target_type = title
	target_filter = actor_domain_titles

	auto_accept = yes

	is_shown = { scope:actor = { this = scope:recipient } }

	can_be_picked_title = {
		scope:target = {
			holder = scope:actor
			is_capital_barony = no # we'll use the county in that case
			trigger_if = {
				limit = { tier <= tier_county }
				title_province = {
					has_holding_type = settlement_holding
				}
			}
			trigger_else = {
				custom_description = {
					text = "feudalize_tribal_holding_interaction_title_not_county_or_below"
					always = no
				}
			}
		}
	}

	has_valid_target_showing_failures_only = {
	}

	on_accept = {
		scope:actor = {
			make_settlement_county_wilderness = { COUNTY = scope:target }
			trigger_event = agot_colonization_events.0007
		}
	}

	ai_will_do = {
		base = 150
	}
}

feudalize_into_castle_holding_interaction = {
	category = interaction_category_uncategorized
	hidden = yes

	desc = feudalize_into_castle_holding_interaction_desc

	target_type = title
	target_filter = actor_domain_titles

	auto_accept = yes

	is_shown = {
		scope:actor = {
			this = scope:recipient
			NOT = {
				government_has_flag = government_is_tribal
			}

		}
	}

	can_be_picked_title = {
		scope:target = {
			holder = scope:actor
			is_capital_barony = no # we'll use the county in that case
			trigger_if = {
				limit = { tier <= tier_county }
				title_province = {
					has_holding_type = settlement_holding
				}
			}
			trigger_else = {
				custom_description = {
					text = "feudalize_tribal_holding_interaction_title_not_county_or_below"
					always = no
				}
			}
		}
	}

	has_valid_target_showing_failures_only = {
		trigger_if = {
			limit = { NOT = { scope:target.title_province = scope:target.county.title_province } } # Is the selected barony NOT the capital barony
			NOT = { scope:target.county.title_province = { has_holding_type = settlement_holding } }
		}
		scope:target = {
			trigger_if = {
				limit = { tier <= tier_county }
				title_province = {
					barony_controller = scope:actor
					has_ongoing_construction = no
				}
			}
		}
		scope:target = {
			trigger_if = {
				limit = {
					title_province = {
						has_holding_type = settlement_holding
					}
				}
				custom_tooltip = {
					text = blockers_remain_in_settlement
					title_province = {
						has_building_with_flag = {
							flag = obstacle
							count = 0
						}
					}
				}
				development_level >= 3
				custom_tooltip = {
					text = has_fully_upgraded_settlement_holding
					title_province = { has_building = settlement_03 }
				}
			}
		}
	}

	cost = {
		gold = {
			value = 0

			if = {
				limit = { scope:actor= { is_ai = no } }
				add = feudalize_tribal_holding_interaction_cost
			}
		}
	}

	on_accept = {
		scope:actor = {
			send_interface_toast = {
				title = feudalize_into_castle_holding_interaction_notification

				right_icon = scope:actor

				if = {
					limit = { exists = scope:target.title_province }
					scope:target.title_province = {
						set_holding_type = castle_holding
					}
					scope:target = { set_color_from_title = scope:target.de_jure_liege }
				}
				if = {
					limit = { scope:target.tier = tier_county }
					scope:target = { agot_remove_permafrost_modifiers = yes }
				}
			}
			if = {
				limit = {
					has_variable = num_settled_wilderness
					var:num_settled_wilderness > 0
				}
				decrease_variable = {
					NAME = num_settled_wilderness
					AMOUNT = 1
				}
				remove_wilderness_tracker_variable = yes
				trigger_event = agot_colonization_events.0007
			}
		}
	}

	ai_will_do = {
		base = 150
	}
}

feudalize_into_city_holding_interaction = {
	category = interaction_category_uncategorized
	hidden = yes

	desc = feudalize_into_city_holding_interaction_desc

	target_type = title
	target_filter = actor_domain_titles

	auto_accept = yes

	is_shown = {
		scope:actor = {
			this = scope:recipient
			NOT = {
				government_has_flag = government_is_tribal
			}
		}
	}

	can_be_picked_title = {
		scope:target = {
			holder = scope:actor
			#is_capital_barony = no # we'll use the county in that case
			trigger_if = {
				limit = { tier <= tier_county }
				title_province = {
					has_holding_type = settlement_holding
				}
			}
			trigger_else = {
				custom_description = {
					text = "feudalize_tribal_holding_interaction_title_not_county_or_below"
					always = no
				}
			}
		}
	}

	has_valid_target_showing_failures_only = {
		trigger_if = {
			limit = { NOT = { scope:target.title_province = scope:target.county.title_province } } # Is the selected barony NOT the capital barony
			NOT = { scope:target.county.title_province = { has_holding_type = settlement_holding } }
		}

		scope:target = { # Target province has an ongoing construction
			trigger_if = {
				limit = { tier <= tier_county }
				title_province = {
					barony_controller = scope:actor
					has_ongoing_construction = no
				}
			}
		}
		scope:target = { # Whether the title meets the requirements to upgrade into normal holding
			trigger_if = {
				limit = {
					title_province = {
						has_holding_type = settlement_holding
					}
				}
				custom_tooltip = { # Blockers remain in the settlement
					text = blockers_remain_in_settlement
					title_province = {
						has_building_with_flag = {
							flag = obstacle
							count = 0
						}
					}
				}
				development_level >= 3 # Development needs to be at least >= 3
				custom_tooltip = { # Settlement needs to be upgraded to the maximum
					text = has_fully_upgraded_settlement_holding
					title_province = { has_building = settlement_03 }
				}
			}
		}
	}

	cost = {
		gold = {
			value = 0

			if = {
				limit = { scope:actor = { is_ai = no } }
				add = feudalize_tribal_holding_interaction_cost
			}
		}
	}

	on_accept = {
		scope:actor = {
			send_interface_toast = {
				title = feudalize_into_city_holding_interaction_notification

				right_icon = scope:actor

				if = {
					limit = { exists = scope:target.title_province }
					scope:target.title_province = {
						set_holding_type = city_holding
					}
					scope:target = { set_color_from_title = scope:target.de_jure_liege }
				}
				if = {
					limit = { scope:target.tier = tier_county }
					scope:target = { agot_remove_permafrost_modifiers = yes }
				}
			}
			if = {
				limit = {
					has_variable = num_settled_wilderness
					var:num_settled_wilderness > 0
				}
				decrease_variable = {
					NAME = num_settled_wilderness
					AMOUNT = 1
				}
				remove_wilderness_tracker_variable = yes
				trigger_event = agot_colonization_events.0007
			}
		}
	}

	ai_will_do = {
		base = 150
	}
}

feudalize_into_temple_holding_interaction = {
	category = interaction_category_uncategorized
	hidden = yes

	desc = feudalize_into_temple_holding_interaction_desc

	target_type = title
	target_filter = actor_domain_titles

	auto_accept = yes

	is_shown = {
		scope:actor = {
			this = scope:recipient
			NOT = {
				government_has_flag = government_is_tribal
			}
		}
	}

	can_be_picked_title = {
		scope:target = {
			holder = scope:actor
			is_capital_barony = no # we'll use the county in that case
			trigger_if = {
				limit = { tier <= tier_county }
				title_province = {
					has_holding_type = settlement_holding
				}
			}
			trigger_else = {
				custom_description = {
					text = "feudalize_tribal_holding_interaction_title_not_county_or_below"
					always = no
				}
			}
		}
	}

	has_valid_target_showing_failures_only = {
		trigger_if = {
			limit = { NOT = { scope:target.title_province = scope:target.county.title_province } } # Is the selected barony NOT the capital barony
			NOT = { scope:target.county.title_province = { has_holding_type = settlement_holding } }
		}

		scope:target = {
			title_province = {
				is_county_capital = no
			}
			trigger_if = {
				limit = { tier <= tier_county }
				title_province = {
					barony_controller = scope:actor
					has_ongoing_construction = no
				}
			}
		}
		scope:target = {
			trigger_if = {
				limit = {
					title_province = {
						has_holding_type = settlement_holding
					}
				}
				custom_tooltip = {
					text = blockers_remain_in_settlement
					title_province = {
						has_building_with_flag = {
							flag = obstacle
							count = 0
						}
					}
				}
				development_level >= 3
				custom_tooltip = {
					text = has_fully_upgraded_settlement_holding
					title_province = { has_building = settlement_03 }
				}
			}
		}
	}

	cost = {
		gold = {
			value = 0

			if = {
				limit = { scope:actor = { is_ai = no } }
				add = feudalize_tribal_holding_interaction_cost
			}
		}
	}

	on_accept = {
		scope:actor = {
			send_interface_toast = {
				title = feudalize_into_temple_holding_interaction_notification

				right_icon = scope:actor

				if = {
					limit = { exists = scope:target.title_province }
					scope:target.title_province = {
						set_holding_type = church_holding
					}
					scope:target = { set_color_from_title = scope:target.de_jure_liege }
				}
				if = {
					limit = { scope:target.tier = tier_county }
					scope:target = { agot_remove_permafrost_modifiers = yes }
				}
			}
			if = {
				limit = {
					has_variable = num_settled_wilderness
					var:num_settled_wilderness > 0
				}
				decrease_variable = {
					NAME = num_settled_wilderness
					AMOUNT = 1
				}
				remove_wilderness_tracker_variable = yes
				trigger_event = agot_colonization_events.0007
			}
		}
	}

	ai_will_do = {
		base = 150
	}
}

tribalize_settlement_holding_interaction = {
	category = interaction_category_uncategorized
	hidden = yes

	desc = tribalize_settlement_holding_interaction_desc

	target_type = title
	target_filter = actor_domain_titles

	auto_accept = yes

	is_shown = {
		scope:actor = {
			this = scope:recipient
			government_has_flag = government_is_tribal
		}
	}

	cost = {
		gold = {
			value = settle_settlement_holding_interaction_cost
			divide = 2
		}
		prestige = {
			value = settle_settlement_holding_interaction_cost
			multiply = 2
		}
	}

	can_be_picked_title = {
		scope:target = {
			holder = scope:actor
			is_capital_barony = no # we'll use the county in that case
			trigger_if = {
				limit = { tier <= tier_county }
				title_province = {
					has_holding_type = settlement_holding
				}
			}
			trigger_else = {
				custom_tooltip = {
					text = tribalize_settlement_holding_interaction_title_not_county_or_below
					always = no
				}
			}
		}
	}

	has_valid_target_showing_failures_only = {
		scope:target = {
			trigger_if = {
				limit = { tier <= tier_county }
				title_province = {
					barony_controller = scope:actor
					has_ongoing_construction = no
				}
			}
		}
		scope:target = {
			trigger_if = {
				limit = {
					title_province = {
						has_holding_type = settlement_holding
					}
				}
				custom_tooltip = {
					text = blockers_remain_in_settlement
					title_province = {
						has_building_with_flag = {
							flag = obstacle
							count = 0
						}
					}
				}
				custom_tooltip = {
					text = has_fully_upgraded_settlement_holding
					title_province = { has_building = settlement_03 }
				}
			}
		}
	}

	on_accept = {
		scope:actor = {
			send_interface_toast = {
				title = tribalize_settlement_holding_interaction_notification

				right_icon = scope:actor

				if = {
					limit = {
						exists = scope:target.title_province
						scope:target.title_province = { has_holding_type = settlement_holding }
					}
					scope:target = { set_color_from_title = scope:target.de_jure_liege }
				}

				if = {
					limit = { exists = scope:target.title_province }
					scope:target.title_province = {
						set_holding_type = tribal_holding
					}
				}
			}
		}
		scope:actor = {
			if = {
				limit = {
					has_variable = num_settled_wilderness
					var:num_settled_wilderness > 0
				}
				decrease_variable = {
					NAME = num_settled_wilderness
					AMOUNT = 1
				}
				remove_wilderness_tracker_variable = yes
				trigger_event = agot_colonization_events.0007
			}
		}
	}

	ai_will_do = {
		base = 150
	}
}

colonize_pirate_den_interaction = {
	category = interaction_category_uncategorized
	hidden = yes
	special_interaction = feudalize_holding

	desc = colonize_pirate_den_interaction_desc

	target_type = title
	target_filter = actor_domain_titles

	auto_accept = yes

	is_shown = {
		scope:actor = {
			this = scope:recipient
			NOT = { government_has_flag = government_is_pirate }
		}
	}

	can_be_picked_title = {
		scope:target = {
			holder = scope:actor
			is_capital_barony = no # we'll use the county in that case
			trigger_if = {
				limit = { tier <= tier_county }
				title_province = { has_holding_type = pirate_den_holding }
			}
			trigger_else = {
				custom_description = {
					text = "colonize_pirate_den_interaction_title_not_county_or_below"
					always = no
				}
			}
		}
	}

	has_valid_target_showing_failures_only = {
		scope:target = {
			trigger_if = {
				limit = { tier <= tier_county }
				title_province = {
					barony_controller = scope:actor
					has_ongoing_construction = no
				}
			}
		}
	}

	on_accept = {
		scope:actor = {
			send_interface_toast = {
				type = event_toast_effect_good
				title = colonize_pirate_den_interaction_notification

				right_icon = scope:actor

				if = {
					limit = { exists = scope:target.title_province }
					scope:target.title_province = {
						colonize_pirate_den_effect = { COLONIZER = scope:actor PIRATE_DEN = scope:target.title_province }
					}
				}
			}
		}
	}

	# Interaction frequency determined by code, do not change
	ai_frequency = 0

	# Used to determine which holding should be feudalized over another AND how important this AI goal is compared to others, like creating titles and constructing new holdings
	ai_will_do = {
		base = 1500
	}
}

support_colonize_pirate_den_interaction = {
	category = interaction_category_vassal
	icon = request_funding_interaction

	desc = support_colonize_pirate_den_interaction_desc

	target_type = title
	target_filter = recipient_domain_titles

	auto_accept = yes

	is_shown = {
		scope:actor = {
			NOT = { government_has_flag = government_is_pirate }
		}
		scope:recipient = {
			target_is_liege_or_above = scope:actor
			NOT = { government_has_flag = government_is_tribal }
			NOT = { this = scope:actor }
			any_held_title = {
				tier <= tier_county
				title_province = {
					has_holding_type = pirate_den_holding
				}
			}
		}
	}

	can_be_picked_title = {
		scope:target = {
			is_capital_barony = no # we'll use the county in that case

			trigger_if = {
				limit = { tier <= tier_county }
				title_province = {
					barony_controller = scope:recipient
					has_ongoing_construction = no
				}
			}
		}
	}

	has_valid_target_showing_failures_only = {
		scope:target = {
			trigger_if = {
				limit = { tier <= tier_county }
				title_province = {
					has_holding_type = pirate_den_holding
				}
			}
			trigger_else = {
				custom_description = {
					text = "feudalize_holding_interaction_title_not_county_or_below"
					always = no
				}
			}
		}
	}

	is_highlighted = {
		# Highlight the interaction if we have the gold to spare
		scope:actor = {
			gold >= {
				value = feudalize_holding_interaction_cost
			}
		}
	}

	on_accept = {
		scope:recipient = {
			# Add some opinion to make it worthwhile
			add_opinion = {
				target = scope:actor
				modifier = grateful_opinion
				opinion = 15
			}

			# Notify actor and recipient
			scope:actor = {
				send_interface_toast = {
					type = event_toast_effect_good
					title = colonize_pirate_den_interaction_notification

					left_icon = scope:actor
					right_icon = scope:target

					if = {
						limit = { exists = scope:target.title_province }
						scope:target.title_province = {
							set_holding_type = castle_holding
						}
					}
				}
			}
		}
		scope:actor = {
			# If you are admin, you get some influence for your efforts
			if = {
				limit = { government_has_flag = government_is_administrative }
				change_influence = medium_influence_gain
			}
		}
	}

	# The AI doesn't check this very often - So if they have more important expenses, they will put their gold to better use first.
	ai_frequency = 72

	ai_targets = {
		ai_recipients = vassals
		max = 10
	}

	ai_potential = {
		# Some basic triggers
		is_at_war = no
		is_adult = yes
		# The AI only does this if they have plenty of gold to spare
		gold >= { value = feudalize_holding_interaction_cost multiply = 4 }
		# Warring AI don't do this - They want to spend their gold on war!
		ai_has_warlike_personality = no
		ai_has_conqueror_personality = no
	}

	ai_will_do = {
		base = 25
		modifier = {
			scope:actor = { ai_has_economical_boom_personality = yes }
			add = 50
		}
	}
}