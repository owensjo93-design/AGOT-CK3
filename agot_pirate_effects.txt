agot_get_potential_pirate_effect = {
	random_living_character = {
		limit = { agot_potential_pirate = yes }
		weight = {
			base = 1
			modifier = {
				add = prowess
			}
			modifier = {
				add = martial
			}
			modifier = {
				add = 100
				has_trait = ambitious
			}
			modifier = {
				add = 50
				has_trait = brave
			}
			modifier = {
				add = 50
				has_trait = bastard
			}
			modifier = {
				add = 300
				is_character_velaryon_5 = yes
			}
			modifier = {
				add = 300
				is_character_greyjoy_13 = yes
			}
		}
		save_scope_as = potential_pirate
	}
	if = {
		limit = {
			NOT = { exists = scope:potential_pirate }
		}
		random_county_in_region = {
			region = world_stepstones
			limit = {
				NOT = {
					holder = { government_has_flag = government_is_wilderness }
				}
			}
			save_scope_as = stepstones_county
		}
		create_character = {
			location = title:b_the_stash.title_province
			template = stepstones_warrior_character
			save_scope_as = potential_pirate
		}
	}
}

pirate_adventurer_start_war_effect = {
	$PIRATE$ = { save_scope_as = pirate_adventurer }
	$TARGET$ = { save_scope_as = adventurer_target }

	#Give the adventurer a dynamic title to tide them over.
	create_dynamic_title = {
		tier = duchy
		name = PIRATE_ARMY_NEUTRAL_NAME
	}
	create_title_and_vassal_change = {
		type = created
		save_scope_as = change
		add_claim_on_loss = no
	}
	scope:new_title = {
		set_capital_county = scope:adventurer_target
		set_landless_title = yes
		set_destroy_on_gain_same_tier = yes
		set_no_automatic_claims = yes
		set_can_be_named_after_dynasty = no
		change_title_holder = {
			holder = scope:pirate_adventurer
			change = scope:change
		}
	}
	resolve_title_and_vassal_change = scope:change
	scope:new_title = {
		generate_coa = yes
		set_variable = {
			name = temporary_title
			value = yes
		}
	}
	#Declare the war.
	scope:pirate_adventurer = {
		start_war = {
			casus_belli = pirate_adventurer_conquest
			target = scope:adventurer_target.holder.top_liege
			target_title = scope:adventurer_target.duchy
		}
	}
	# Setup event troops.
	scope:pirate_adventurer = {
		add_character_modifier = pirate_adventurer_modifier
		add_trait = adventurer
		# Work out how many event troops we should give the adventurer for a 60:40 fight.
		spawn_army = {
			levies = {
				add = {
					#Base of 400.
					add = scope:adventurer_target.holder.top_liege.max_military_strength
					#Multiply that by the realm size of the target's top_liege.
					multiply = 1.5
					#Account for allies, adding more without just nullifying them.
					scope:adventurer_target.holder.top_liege = {
						every_ally = { add = this.max_military_strength }
					}
					#Cut it off so things don't get too ridiculous.
					max = 8000
					#Make sure all adventurers have a moderately respectable force.
					min = 1000
				}
			}
			inheritable = no
			location = scope:adventurer_target.title_province
			name = pirate_adventurer_event_troops
		}
		spawn_army = {
			men_at_arms = {
				type = westerosi_sellswords
				stacks = {
					value = 1
					multiply = scope:adventurer_target.holder.top_liege.primary_title.tier
				}
			}
			inheritable = yes
			location = scope:adventurer_target.title_province
			name = pirate_adventurer_event_troops
		}
		spawn_army = {
			men_at_arms = {
				type = stepstone_sailors
				stacks = {
					value = 1
					multiply = scope:adventurer_target.holder.top_liege.primary_title.tier
				}
			}
			inheritable = yes
			location = scope:adventurer_target.title_province
			name = pirate_adventurer_event_troops
		}
		spawn_army = {
			men_at_arms = {
				type = mangonel
				stacks = 2
			}
			inheritable = yes
			location = scope:adventurer_target.title_province
			name = pirate_adventurer_event_troops
		}
	}
	# Loan a little gold in case they're in debt/to keep them going.
	scope:pirate_adventurer = { add_gold = pirate_adventurer_efficacy_loan_value }
}

clean_pirate_adventurer_effect = {
	scope:attacker = {
		every_held_title = {
			limit = { has_variable = temporary_title }
			save_scope_as = destroyable_title
			scope:attacker = { destroy_title = scope:destroyable_title }
		}
		remove_character_modifier = pirate_adventurer_modifier
	}
}

add_realm_size_appropriate_pirate_adventurer_reprieve_effect = {
	# Depending on the sub realm size of $VICTIM$, we give them a scaling amount of time not to be hit by SA attacks.
	## The smallest realms get a long reprieve.
	if = {
		limit = { sub_realm_size <= tiny_realm_size }
		add_character_modifier = {
			modifier = proven_against_pirates_modifier
			years = 20
		}
	}
	## Then a decent reprieve.
	else_if = {
		limit = { sub_realm_size <= minor_realm_size }
		add_character_modifier = {
			modifier = proven_against_pirates_modifier
			years = 15
		}
	}
	## Then a short reprieve.
	else_if = {
		limit = { sub_realm_size <= medium_realm_size }
		add_character_modifier = {
			modifier = proven_against_pirates_modifier
			years = 10
		}
	}
	## Then you're clearly too big and juicy a target for much reprieve at all.
	else = {
		add_character_modifier = {
			modifier = proven_against_pirates_modifier
			years = 5
		}
	}
}