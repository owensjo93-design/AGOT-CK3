title_has_kingsguard_trigger = {
	tier = tier_empire
	has_variable = kingsguard
}

ruler_has_kingsguard_trigger = {
	any_held_title = {
		title_has_kingsguard_trigger = yes
	}
}

ruler_primary_title_has_kingsguard_trigger = {
	exists = primary_title
	primary_title = {
		title_has_kingsguard_trigger = yes
	}
}

can_be_kingsguard_trigger = {
	can_be_councillor_basics_trigger = yes
	OR = {
		is_ruler = no
		AND = {
			has_title = title:d_kingsguard
			has_trait = kingsguard
		}
	}
	is_married = no
	is_capable_adult = yes
	is_human = yes
	NOR = {
		has_trait = nightswatch
		has_trait = dragon #Go away Drogon
		has_trait = order_member #Go away Areo Hotah
		has_trait = devoted
		has_trait = septon
		has_trait = maester
	}
	save_temporary_scope_as = root_character
	OR = {
		can_be_knight_trigger = { ARMY_OWNER = $COURT_OWNER$ }
		#for historical KG who don't meet reqs
		has_trait = kingsguard
	}
	valid_kingsguard_gender_trigger = yes
}

valid_kingsguard_gender_trigger = {
	is_male = yes
}

highborn_kingsguard_candidate = {
	is_lowborn = no
	trigger_if = {
		limit = {
			any_close_or_extended_family_member = {
				AND = {
					is_landed = yes
					this = prev.employer
				}
			}
		}
		highest_held_title_tier >= tier_county
	}
	NOT = { #Don't send your heir dummy
		any_heir_title = {
			place_in_line_of_succession = {
				target = prev
				value == 1
			}
		}
		has_trait = kingsguard
		has_trait = nightswatch
		has_trait = maester
		has_trait = order_member
	}
	NOT = { exists = betrothed }
	has_trait = education_martial_prowess #Send me people who can fight plz
	trigger_if = {
		limit = {
			faith != root.faith
		}
		OR = {
			has_character_modifier = training_for_kingsguard
			house ?= {
				house_head = {
					opinion = {
						target = root
						value >= 51
					}
				}
			}
		}
	}
}

can_have_kingsguard = {
	ruler_primary_title_has_kingsguard_trigger = yes
	# TODO pretenders should also be able to have a kingsguard; eg Rhaenyra or Daenerys
}

valid_kingsguard_bodyguard_councillor = {
	scope:councillor = {
		agot_is_councillor_available_trigger = yes
	}
}

valid_kingsguard_bodyguard_target = {
	OR = {
		dynasty ?= scope:councillor_liege.dynasty
		any_spouse = {
			dynasty ?= scope:councillor_liege.dynasty
		}
	}
	num_of_relation_bodyguard = 0
}

potential_kingsguard_bodyguard_court = {
	scope:councillor = {
		trigger_if = {
			limit = { var:agot_target_court ?= scope:target_character }
			scope:target_character = {
				is_landed = yes
			}
			any_relation = {
				type = bodyguard_target
				is_in_the_same_court_as_or_guest = scope:target_character
				is_imprisoned = no
			}
		}
	}
}

valid_kingsguard_bodyguard_court = {
	custom_description = {
		text = valid_kingsguard_bodyguard_court
		scope:target_character = {
			OR = {
				valid_kingsguard_bodyguard_target = yes
				any_courtier_or_guest = {
					valid_kingsguard_bodyguard_target = yes
				}
			}
		}
	}
}
