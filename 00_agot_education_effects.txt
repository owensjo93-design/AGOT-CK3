agot_add_coming_of_age_prowess_flag_effect = {
	hidden_effect = {
		if = {
			limit = {
				agot_prowess_education_trigger = yes
			}

			#Set a temp variable based on education level and add/subtract based on some traits
			set_variable = {
				name = education_prowess_variable
				value = {
					add = {
						value = prowess
						max = 10
					}
					if = {
						limit = { has_trait = lifestyle_blademaster }
						add = 15
					}
					if = {
						limit = { has_trait = physique_good_3 }
						add = education_large_bonus
					}
					if = {
						limit = { has_trait = physique_good_2 }
						add = education_medium_bonus
					}
					if = {
						limit = { has_trait = physique_good_1 }
						add = education_small_bonus
					}
					if = {
						limit = { has_trait = strong }
						add = education_large_bonus
					}
					if = {
						limit = { has_trait = giant }
						add = education_large_bonus
					}
					if = {
						limit = { has_trait = physique_bad }
						add = education_large_penalty
					}
					if = {
						limit = { has_trait = weak }
						add = education_large_penalty
					}
					if = {
						limit = { has_trait = dwarf }
						add = education_large_penalty
					}
					if = {
						limit = { has_trait = spindly }
						add = education_small_penalty
					}
					if = {
						limit = { has_trait = wheezing }
						add = education_small_penalty
					}
					if = {
						limit = { has_trait = hunchbacked }
						add = education_small_penalty
					}
					if = {
						limit = { has_trait = inbred }
						add = education_large_penalty
					}
					if = {
						limit = { has_trait = bleeder }
						add = education_small_penalty
					}
					if = {
						limit = { has_trait = clubfooted }
						add = education_large_penalty
					}
					if = {
						limit = {
							exists = dynasty
							dynasty = { has_dynasty_perk = dayne_legacy_1 }
						}
						add = education_large_bonus
					}
				}
			}

			#Do a little randomization
			random_list = {
				100 = { # Better
					ai_boldness_target_modifier = { VALUE = 200 }
					ai_energy_target_modifier = { VALUE = 200 }
					change_variable = {
						name = education_prowess_variable
						add = 3 #Up from 2, just enough to hit level 3 with a high roll and 10 prowess
					}
				}
				200 = { } # Nothing
				100 = { # Worse
					ai_boldness_target_modifier = { VALUE = -100 }
					ai_energy_target_modifier = { VALUE = -50 }
					change_variable = {
						name = education_prowess_variable
						add = -5
					}
				}
			}

			#Set trait
			if = {
				limit = {
					var:education_prowess_variable <= education_level_0
				}
			}
			else_if = {
				limit = {
					var:education_prowess_variable <= education_level_1
				}

				add_character_flag = {
					flag = education_martial_prowess_1
					days = 1
				}
			}
			else_if = {
				limit = {
					var:education_prowess_variable <= education_level_2
				}

				add_character_flag = {
					flag = education_martial_prowess_2
					days = 1
				}
			}
			else_if = {
				limit = {
					var:education_prowess_variable <= education_level_3
				}

				add_character_flag = {
					flag = education_martial_prowess_3
					days = 1
				}
			}
			else = {
				add_character_flag = {
					flag = education_martial_prowess_4
					days = 1
				}
			}

			remove_variable = education_prowess_variable
		}
	}
}

agot_add_coming_of_age_martial_prowess_flag_effect = {
	hidden_effect = {
		if = {
			limit = {
				agot_martial_prowess_education_trigger = yes
			}

			#Set a temp variable based on education level and add/subtract based on some traits
			set_variable = {
				name = education_prowess_variable
				value = {
					add = {
						value = prowess
						max = 12
					}
					if = {
						limit = { has_trait = lifestyle_blademaster }
						add = 15
					}
					if = {
						limit = { has_trait = physique_good_3 }
						add = education_large_bonus
					}
					if = {
						limit = { has_trait = physique_good_2 }
						add = education_medium_bonus
					}
					if = {
						limit = { has_trait = physique_good_1 }
						add = education_small_bonus
					}
					if = {
						limit = { has_trait = strong }
						add = education_large_bonus
					}
					if = {
						limit = { has_trait = giant }
						add = education_large_bonus
					}
					if = {
						limit = { has_trait = physique_bad }
						add = education_large_penalty
					}
					if = {
						limit = { has_trait = weak }
						add = education_large_penalty
					}
					if = {
						limit = { has_trait = dwarf }
						add = education_large_penalty
					}
					if = {
						limit = { has_trait = spindly }
						add = education_small_penalty
					}
					if = {
						limit = { has_trait = wheezing }
						add = education_small_penalty
					}
					if = {
						limit = { has_trait = hunchbacked }
						add = education_small_penalty
					}
					if = {
						limit = { has_trait = inbred }
						add = education_large_penalty
					}
					if = {
						limit = { has_trait = bleeder }
						add = education_small_penalty
					}
					if = {
						limit = { has_trait = clubfooted }
						add = education_large_penalty
					}
					if = {
						limit = {
							exists = dynasty
							dynasty = { has_dynasty_perk = dayne_legacy_1 }
						}
						add = education_large_bonus
					}
				}
			}

			#Do a little randomization
			random_list = {
				100 = { # Better
					ai_boldness_target_modifier = { VALUE = 200 }
					ai_energy_target_modifier = { VALUE = 200 }
					change_variable = {
						name = education_prowess_variable
						add = 5
					}
				}
				200 = { } # Nothing
				100 = { # Worse
					ai_boldness_target_modifier = { VALUE = -100 }
					ai_energy_target_modifier = { VALUE = -50 }
					change_variable = {
						name = education_prowess_variable
						add = -5
					}
				}
			}

			#Set trait
			if = {
				limit = {
					var:education_prowess_variable <= education_level_1
					OR = { #Generally give Martial Edu Trained unless there's detractors
						has_trait = craven
						has_trait = lazy
						has_trait = intellect_bad
						has_trait = physique_bad
						has_trait = weak
						has_trait = spindly
						has_trait = clubfooted
					}
				}

				add_character_flag = {
					flag = education_martial_prowess_1
					days = 1
				}
			}
			else_if = {
				limit = {
					var:education_prowess_variable <= education_level_2
				}

				add_character_flag = {
					flag = education_martial_prowess_2
					days = 1
				}
			}
			else_if = {
				limit = {
					var:education_prowess_variable < education_level_3
				}

				add_character_flag = {
					flag = education_martial_prowess_3
					days = 1
				}
			}
			else = {
				add_character_flag = {
					flag = education_martial_prowess_4
					days = 1
				}
			}

			remove_variable = education_prowess_variable
		}
	}
}

agot_add_coming_of_age_republican_flag_effect = {
	hidden_effect = {
		if = {
			limit = {
				agot_republic_education_trigger = yes
			}

			if = {
				limit = {
					exists = scope:educator
					exists = scope:educator.liege_or_court_owner
					exists = scope:educator.liege_or_court_owner.capital_county.title_province
				}
				scope:educator.liege_or_court_owner.capital_county.title_province.county = { save_scope_as = dev_county }
			}
			else_if = {
				limit = {
					exists = liege_or_court_owner
					exists = liege_or_court_owner.capital_county.title_province
				}
				liege_or_court_owner.capital_county.title_province.county = { save_scope_as = dev_county }
			}
			else = {
				location.county = { save_scope_as = dev_county }
			}

			#Set a temp variable based on education level and add/subtract based on some traits
			set_variable = {
				name = education_republican_variable
				value = {

					add = {
						value = stewardship
						divide = 2
						max = 5
					}
					add = {
						value = intrigue
						divide = 2
						max = 5
					}
					if = {
						limit = { scope:dev_county.development_level > 20 }
						add = education_large_bonus
					}
					if = {
						limit = { scope:dev_county.development_level > 15 }
						add = education_medium_bonus
					}
					if = {
						limit = { scope:dev_county.development_level > 10 }
						add = education_small_bonus
					}

					if = {
						limit = { has_trait = intellect_good_3 }
						add = education_large_bonus
					}
					if = {
						limit = { has_trait = intellect_good_2 }
						add = education_medium_bonus
					}
					if = {
						limit = { has_trait = intellect_good_1 }
						add = education_small_bonus
					}
					if = {
						limit = { has_trait = shrewd }
						add = education_medium_bonus
					}
					if = {
						limit = { has_trait = diligent }
						add = education_medium_bonus
					}
					if = {
						limit = { has_trait = ambitious }
						add = education_medium_bonus
					}
					if = {
						limit = { has_trait = greedy }
						add = education_small_bonus
					}
					if = {
						limit = { has_trait = calm }
						add = education_small_bonus
					}
					if = {
						limit = { has_trait = patient }
						add = education_small_bonus
					}
					if = {
						limit = { has_trait = deceitful }
						add = education_small_bonus
					}
					if = {
						limit = { has_trait = curious }
						add = education_small_bonus
					}

					if = {
						limit = { has_trait = intellect_bad }
						add = education_large_penalty
					}
					if = {
						limit = { has_trait = dull }
						add = education_large_penalty
					}
					if = {
						limit = { has_trait = lazy }
						add = education_medium_penalty
					}
					if = {
						limit = { has_trait = arbitrary }
						add = education_small_penalty
					}
					if = {
						limit = { has_trait = fickle }
						add = education_small_penalty
					}
					if = {
						limit = { has_trait = impatient }
						add = education_small_penalty
					}
					if = {
						limit = { has_trait = zealous }
						add = education_small_penalty
					}
					if = {
						limit = { has_trait = stubborn }
						add = education_small_penalty
					}
					if = {
						limit = { has_trait = drunkard }
						add = education_small_penalty
					}
					if = {
						limit = { has_trait = rowdy }
						add = education_small_penalty
					}
				}
			}

			#Do a little randomization
			random_list = {
				100 = { # Better
					ai_rationality_target_modifier = { VALUE = 200 }
					change_variable = {
						name = education_republican_variable
						add = 3 #Up from 2, just enough to hit level 3 with a high roll
					}
				}
				50 = { } # Nothing
				100 = { # Worse
					ai_rationality_target_modifier = { VALUE = -100 }
					change_variable = {
						name = education_republican_variable
						add = -5
					}
				}
			}

			#Set trait
			if = {
				limit = {
					var:education_republican_variable <= education_level_0
				}
			}
			else_if = {
				limit = {
					var:education_republican_variable <= education_level_1
				}

				add_character_flag = {
					flag = education_republican_knowledge_1
					days = 1
				}
			}
			else_if = {
				limit = {
					var:education_republican_variable <= education_level_2
				}

				add_character_flag = {
					flag = education_republican_knowledge_2
					days = 1
				}
			}
			else_if = {
				limit = {
					var:education_republican_variable <= education_level_3
				}

				add_character_flag = {
					flag = education_republican_knowledge_3
					days = 1
				}
			}
			else = {

				add_character_flag = {
					flag = education_republican_knowledge_4
					days = 1
				}
			}

			remove_variable = education_republican_variable
		}
	}
}

agot_coming_of_age_education_flags_to_traits = {
	if = {
		limit = { has_character_flag = education_republican_knowledge_1 }
		add_trait = education_republican_knowledge_1
	}
	else_if = {
		limit = { has_character_flag = education_republican_knowledge_2 }
		add_trait = education_republican_knowledge_2
	}
	else_if = {
		limit = { has_character_flag = education_republican_knowledge_3 }
		add_trait = education_republican_knowledge_3
	}
	else_if = {
		limit = { has_character_flag = education_republican_knowledge_4 }
		add_trait = education_republican_knowledge_4
	}

	if = {
		limit = { has_character_flag = education_martial_prowess_1 }
		add_trait = education_martial_prowess_1
	}
	else_if = {
		limit = { has_character_flag = education_martial_prowess_2 }
		add_trait = education_martial_prowess_2
	}
	else_if = {
		limit = { has_character_flag = education_martial_prowess_3 }
		add_trait = education_martial_prowess_3
	}
	else_if = {
		limit = { has_character_flag = education_martial_prowess_4 }
		add_trait = education_martial_prowess_4
	}
}
