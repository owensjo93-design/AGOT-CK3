determine_primary_story_effect_lover = {
	if = {
		limit = {
			$LOVER_1$ = {
				should_be_primary_lover = { TARGET = $LOVER_2$ }
			}
		}
		$LOVER_1$ = { save_scope_as = primary_lover }
		$LOVER_2$ = { save_scope_as = secondary_lover }
	}
	else = {
		$LOVER_1$ = { save_scope_as = secondary_lover }
		$LOVER_2$ = { save_scope_as = primary_lover }
	}
}

move_pool_lover_to_root_location = {
	if = {
		limit = {
			$TARGET$ = {
				is_pool_character = yes
				exists = location
				NOT = { location = root.location }
			}
		}
		$TARGET$.location = { save_scope_as = lover_location }
		root.location = { save_scope_as = my_location }
		$TARGET$ = {
			every_traveling_family_member = {
				limit = { is_in_pool_at = scope:lover_location }
				hidden_effect = {
					move_to_pool_at = scope:my_location
					set_variable = {
						name = last_visited_ruler
						value = scope:my_location.county.holder
						days = 1825
					}
				}
			}
		}
	}
}

remove_lover_modifiers_effect = {
	if = {
		limit = {
			exists = scope:story.var:lmf_lover_1000_modifier
			scope:story.var:lmf_lover_1000_modifier = scope:story.var:lover_target
		}
		remove_character_modifier = soulmate_bliss_modifier
		scope:story = { remove_variable = lmf_lover_1000_modifier }
	}
	if = {
		limit = {
			exists = scope:story.var:lmf_lover_1030_modifier
			scope:story.var:lmf_lover_1030_modifier = scope:story.var:lover_target
		}
		if = {
			limit = { has_character_modifier = lover_diplomacy_help_modifier }
			remove_character_modifier = lover_diplomacy_help_modifier
		}
		if = {
			limit = { has_character_modifier = lover_diplomacy_help_small_modifier }
			remove_character_modifier = lover_diplomacy_help_small_modifier
		}
		if = {
			limit = { has_character_modifier = lover_martial_help_modifier }
			remove_character_modifier = lover_martial_help_modifier
		}
		if = {
			limit = { has_character_modifier = lover_martial_help_small_modifier }
			remove_character_modifier = lover_martial_help_small_modifier
		}
		if = {
			limit = { has_character_modifier = lover_stewardship_help_modifier }
			remove_character_modifier = lover_stewardship_help_modifier
		}
		if = {
			limit = { has_character_modifier = lover_stewardship_help_small_modifier }
			remove_character_modifier = lover_stewardship_help_small_modifier
		}
		if = {
			limit = { has_character_modifier = lover_intrigue_help_modifier }
			remove_character_modifier = lover_intrigue_help_modifier
		}
		if = {
			limit = { has_character_modifier = lover_intrigue_help_small_modifier }
			remove_character_modifier = lover_intrigue_help_small_modifier
		}
		if = {
			limit = { has_character_modifier = lover_learning_help_modifier }
			remove_character_modifier = lover_learning_help_modifier
		}
		if = {
			limit = { has_character_modifier = lover_learning_help_small_modifier }
			remove_character_modifier = lover_learning_help_small_modifier
		}
		scope:story = { remove_variable = lmf_lover_1030_modifier }
	}
	if = {
		limit = {
			exists = scope:story.var:lmf_lover_1045_modifier
			scope:story.var:lmf_lover_1045_modifier = scope:story.var:lover_target
		}
		if = {
			limit = { has_character_modifier = lover_diplomacy_advice_modifier }
			remove_character_modifier = lover_diplomacy_advice_modifier
		}
		if = {
			limit = { has_character_modifier = lover_diplomacy_advice_small_modifier }
			remove_character_modifier = lover_diplomacy_advice_small_modifier
		}
		if = {
			limit = { has_character_modifier = lover_martial_advice_modifier }
			remove_character_modifier = lover_martial_advice_modifier
		}
		if = {
			limit = { has_character_modifier = lover_martial_advice_small_modifier }
			remove_character_modifier = lover_martial_advice_small_modifier
		}
		if = {
			limit = { has_character_modifier = lover_stewardship_advice_modifier }
			remove_character_modifier = lover_stewardship_advice_modifier
		}
		if = {
			limit = { has_character_modifier = lover_stewardship_advice_small_modifier }
			remove_character_modifier = lover_stewardship_advice_small_modifier
		}
		if = {
			limit = { has_character_modifier = lover_intrigue_advice_modifier }
			remove_character_modifier = lover_intrigue_advice_modifier
		}
		if = {
			limit = { has_character_modifier = lover_intrigue_advice_small_modifier }
			remove_character_modifier = lover_intrigue_advice_small_modifier
		}
		if = {
			limit = { has_character_modifier = lover_learning_advice_modifier }
			remove_character_modifier = lover_learning_advice_modifier
		}
		if = {
			limit = { has_character_modifier = lover_learning_advice_small_modifier }
			remove_character_modifier = lover_learning_advice_small_modifier
		}
		scope:story = { remove_variable = lmf_lover_1045_modifier }
	}
	if = {
		limit = {
			exists = scope:story.var:lmf_lover_1050_modifier
			scope:story.var:lmf_lover_1050_modifier = scope:story.var:lover_target
		}
		if = {
			limit = { has_character_modifier = physician_lover_nurses_me_modifier }
			remove_character_modifier = physician_lover_nurses_me_modifier
		}
		if = {
			limit = { has_character_modifier = lover_nurses_me_modifier }
			remove_character_modifier = lover_nurses_me_modifier
		}
		scope:story = { remove_variable = lmf_lover_1050_modifier }
	}
	if = {
		limit = {
			exists = scope:story.var:lmf_lover_1110_modifier
			scope:story.var:lmf_lover_1110_modifier = scope:story.var:lover_target
		}
		remove_character_modifier = lover_distraction_modifier
		scope:story = { remove_variable = lmf_lover_1110_modifier }
	}
	if = {
		limit = {
			exists = scope:story.var:lmf_lover_1170_modifier
			scope:story.var:lmf_lover_1170_modifier = scope:story.var:lover_target
		}
		scope:story.var:lover_target = {
			if = {
				limit = { has_character_modifier = physician_lover_nurses_me_modifier }
				remove_character_modifier = physician_lover_nurses_me_modifier
			}
			if = {
				limit = { has_character_modifier = lover_nurses_me_modifier }
				remove_character_modifier = lover_nurses_me_modifier
			}
		}
		scope:story = { remove_variable = lmf_lover_1170_modifier }
	}
}

make_naked_effect = {
	add_character_flag = is_naked
	add_character_flag = no_hat
}

remove_naked_effect = {
	remove_character_flag = is_naked
	remove_character_flag = no_hat
}

recheck_disease_recovery_effect = {
	if = { #Ill
		limit = { has_trait = ill }
		trigger_event = {
			id = health.1101
			days = { ill_recovery_min ill_recovery_max }
		}
	}
	else_if = { #Pneumonic
		limit = { has_trait = pneumonic }
		trigger_event = {
			id = health.1102
			days = { pneumonic_recovery_min pneumonic_recovery_max }
		}
	}
	else_if = { #Gout
		limit = { has_trait = gout_ridden }
		random = {
			chance = 25
			modifier = {
				has_trait = gluttonous
				add = -15
			}
			modifier = {
				has_trait = temperate
				add = 15
			}
			trigger_event = {
				id = health.1103
				days = { gout_ridden_recovery_min gout_ridden_recovery_max } #1 to 30 years
			}
		}
	}
	else_if = { #Typhus
		limit = { has_trait = typhus }
		trigger_event = {
			id = health.1105
			days = { 45 150 }
		}
	}
	else_if = { #Consumption
		limit = { has_trait = consumption }
		trigger_event = {
			id = health.1106
			days = { 365 2190 } #1 to 6 years
		}
	}
	else_if = { #Cancer
		limit = { has_trait = cancer }
		random = {
			chance = 1
			trigger_event = {
				id = health.1107
				days = { 365 3650 } #1 to 10 years
			}
		}
	}
	else_if = { #Great pox
		limit = {
			OR = {
				has_trait = early_great_pox
				has_trait = great_pox
			}
		}
		trigger_event = {
			id = health.1109
			days = { 730 5475 } #2 to 15 years (note that early pox progresses into great pox in 60-150 days and great pox leads to lunacy after 5 to 15 years)
		}
	}
	else_if = { #Smallpox
		limit = { has_trait = smallpox }
		trigger_event = {
			id = health.1110
			days = { smallpox_min_recovery_time smallpox_max_recovery_time }
		}
	}
	else_if = { #Bubonic Plague
		limit = { has_trait = bubonic_plague }
		trigger_event = {
			id = health.1111
			days = { bubonic_plague_min_recovery_time bubonic_plague_max_recovery_time }
		}
	}
	else_if = { #Measles
		limit = { has_trait = measles }
		trigger_event = {
			id = health.1112
			days = { measles_min_recovery_time measles_max_recovery_time }
		}
	}
	else_if = { #Dysentery
		limit = { has_trait = dysentery }
		trigger_event = {
			id = health.1113
			days = { dysentery_min_recovery_time dysentery_max_recovery_time }
		}
	}
	else_if = { #Ergotism
		limit = { has_trait = ergotism }
		trigger_event = {
			id = health.1114
			days = { ergotism_min_recovery_time ergotism_max_recovery_time }
		}
	}
}