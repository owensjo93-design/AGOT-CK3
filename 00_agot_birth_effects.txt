agot_birth_effects = {
	hidden_effect = {
		agot_assign_strong_seed_effect = yes
		agot_birth_dynasty_effect = yes
		agot_birth_magic_traits_effect = yes
		agot_children_of_bastard_surname_effect = yes
		agot_birth_random_traits_effect = yes
		agot_heir_designation_effect = yes
		agot_dragon_parent_effect = yes
		agot_bittercringe_effect = yes
	}
}

agot_birth_dynasty_effect = {
	if = {
		limit = {
			exists = scope:child.dynasty
			scope:child.dynasty = { has_dynasty_perk = umber_legacy_1 }
			OR = { # The child must have a real parent of the Dynasty...
				scope:mother.dynasty = scope:child.dynasty
				scope:real_father.dynasty = scope:child.dynasty
			}
			NOR = {
				has_trait = physique_good
				has_trait = physique_bad
			}
		}
		random = {
			chance = blood_legacy_4_chance
			add_trait = physique_good_1
		}
	}
	if = {
		limit = {
			exists = scope:child.dynasty
			scope:child.dynasty = { has_dynasty_modifier = valyrian_heritage_dynasty_modifier }
			OR = { # The child must have a real parent of the Dynasty...
				scope:mother.dynasty = scope:child.dynasty
				scope:real_father.dynasty = scope:child.dynasty
			}
			NOR = {
				has_trait = beauty_good
				has_trait = beauty_bad
			}
		}
		random = {
			chance = blood_legacy_4_chance
			add_trait = beauty_good_1
		}
	}
	if = {
		limit = {
			exists = scope:child.dynasty
			scope:child.dynasty = { has_dynasty_perk = borrell_legacy_1 }
			OR = { # The child must have a real parent of the Dynasty...
				scope:mother.dynasty = scope:child.dynasty
				scope:real_father.dynasty = scope:child.dynasty
			}
		}
		add_trait = the_mark
	}
}

agot_birth_magic_traits_effect = {
	random_list = {
		9949 = {
			#you win nothing sir, good day
		}
		50 = {
			trigger = {
				any_ancestor = {
					dynasty ?= dynasty:dynn_Targaryen
				}
			}
			modifier = {
				dynasty ?= dynasty:dynn_Targaryen
				factor = 5
			}
			modifier = {
				culture = {
					has_cultural_parameter = dragon_dreams_more_common
				}
				factor = 3
			}
			modifier = {
				AND = {
					mother.dynasty ?= dynasty:dynn_Targaryen
					real_father.dynasty ?= dynasty:dynn_Targaryen
				}
				factor = 2
			}
			add_character_flag = dragon_dreams
		}
		1 = {
			trigger = {
				any_ancestor = {
					OR = {
						faith = { has_doctrine_parameter = increased_chance_of_greenseers }
						culture = culture:crannogman
					}
				}
			}
			modifier = {
				faith = { has_doctrine_parameter = increased_chance_of_greenseers }
				factor = 5
			}
			modifier = {
				culture = { has_cultural_parameter = greensight_more_common }
				factor = 5
			}
			modifier = {
				culture = { agot_is_wildling_culture = yes }
				factor = 3
			}
			modifier = {
				has_culture = culture:crannogman
				factor = 50
			}
			modifier = {
				AND = {
					mother ?= {
						OR = {
							faith = { has_doctrine_parameter = increased_chance_of_greenseers }
							culture = culture:crannogman
							culture = { agot_is_wildling_culture = yes }
						}
					}
					real_father ?= {
						OR = {
							faith = { has_doctrine_parameter = increased_chance_of_greenseers }
							culture = culture:crannogman
							culture = { agot_is_wildling_culture = yes }
						}
					}
				}
				factor = 2
			}
			add_character_flag = greensight
		}
	}
}

agot_birth_random_traits_effect = {
	if = {
		limit = {
			OR = {
				scope:child.faith = { has_doctrine_parameter = more_likely_born_with_mark }
				scope:child.culture = { has_cultural_parameter = cul_more_likely_born_with_mark }
			}
		}
		random_list = {
			98 = {
				#you win nothing sir, good day
			}
			2 = {
				add_trait = the_mark
			}
		}
	}
}

agot_heir_designation_effect = {
	save_scope_as = potential_heir
	if = {
		limit = {
			scope:father = character:Arryn_3
			scope:is_bastard = no
			exists = scope:father.designated_heir
		}
		#if the child dies it will snap back to Elbert's wife, let's try to avoid that
		remove_trait = sickly
		scope:father = { clear_designated_heir = yes }
	}
	else_if = {
		limit = {
			scope:father = character:Targaryen_60
			character:Targaryen_60 = { has_character_flag = designated_rhaenyra_heir }
			character:Targaryen_60.primary_heir = {
				OR = {
					this = character:Targaryen_63
					this = scope:potential_heir
				}
			}
			character:Targaryen_63 = { is_alive = yes }
			is_alive = yes
			is_male = yes
			NOT = { has_trait = bastard }
		}
		character:Targaryen_60 = {
			clear_designated_heir = yes
			set_designated_heir = character:Targaryen_63
			remove_character_flag = designated_rhaenyra_heir
			if = {
				limit = {
					NOT = {
						has_game_rule = agot_story_sandbox
					}
				}
				trigger_event = {
					id = agot_scenario_trp.1036
					days = 1
				}
			}
		}
	}
}

agot_dragon_parent_effect = {
	if = {
		limit = {
			OR = {
				scope:real_father ?= { has_trait = dragon }
				scope:mother ?= { has_trait = dragon }
			}
			NOT = { has_trait = dragon }
		}
		add_trait = scaly
		if = {
			limit = {
				scope:real_father ?= {
					has_trait = dragon
				}
			}
			set_culture = scope:mother.culture
			set_character_faith = scope:mother.faith
		}
		else_if = {
			limit = {
				scope:mother ?= {
					has_trait = dragon
				}
			}
			set_culture = scope:real_father.culture
			set_character_faith = scope:real_father.faith
		}
	}
}

agot_bittercringe_effect = {
	if = {
		limit = {
			scope:father ?= {
				this = character:Targaryen_95
				house ?= dynasty:dynn_Targaryen.dynasty_founder.house
				NOT = {
					has_character_flag = had_bittersteel_house_decision
				}
			}
		}
		scope:father ?= {
			trigger_event = agot_birth_events.0100
		}
	}
}