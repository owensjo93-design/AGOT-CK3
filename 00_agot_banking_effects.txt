#banking effects by Ronko

agot_init_banking_system = {
	## Initialize Iron Bank
	if = {
		limit = {
			NOT = {
				exists = global_var:IB_location
			}
			title:b_purple_harbor.holder ?= {
				NOT = {
					government_has_flag = government_is_uninteractable
				}
			}
		}
		set_global_variable = {
			name = IB_location
			value = title:b_purple_harbor
		}
	}

	if = {
		limit = {
			NOT = {
				exists = global_var:IB_NofDefaults
			}
		}
		set_global_variable = {
			name = IB_NofDefaults
			value = 0
		}
	}

	if = {
		limit = {
			NOT = {
				exists = global_var:IB_NofLoans
			}
		}
		set_global_variable = {
			name = IB_NofLoans
			value = 0
		}
	}

	if = {
		limit = {
			NOT = {
				exists = global_var:IB_FreeCapital
			}
		}
		set_global_variable = {
			name = IB_FreeCapital
			value = 15000
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:IB_InvestmentFund
			}
		}
		set_global_variable = {
			name = IB_InvestmentFund
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:IB_NofShares
			}
		}
		set_global_variable = {
			name = IB_NofShares
			value = 100
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:IB_LoanedCapital
			}
		}
		set_global_variable = {
			name = IB_LoanedCapital
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:IB_BankValue
			}
		}
		set_global_variable = {
			name = IB_BankValue
			value = 15000
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:IB_ValuePerShare
			}
		}
		set_global_variable = {
			name = IB_ValuePerShare
			value = 150
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:IB_RiskLevel
			}
		}
		set_global_variable = {
			name = IB_RiskLevel   #low = 3, medium = 6, high = 18
			value = 6  #medium
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:IB_DividendLevel
			}
		}
		set_global_variable = {
			name = IB_DividendLevel
			value = 0.75
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:IB_InterestLevel
			}
		}
		set_global_variable = {
			name = IB_InterestLevel   #(-1, 0 +1)
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:IB_Earnings
			}
		}
		set_global_variable = {
			name = IB_Earnings
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:IB_LostLoans
			}
		}
		set_global_variable = {
			name = IB_LostLoans
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:IB_Expenses
			}
		}
		set_global_variable = {
			name = IB_Expenses
			value = 0
		}
	}

	# First custom bank / Rogare Bank
	if = {
		limit = {
			AND = {
				NOT = {
					exists = global_var:bank1_location
				}
				current_year < 8136
			}
		}
		set_global_variable = {
			name = bank1_location
			value = title:b_lys
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank1_NofDefaults
			}
		}
		set_global_variable = {
			name = bank1_NofDefaults
			value = 0
		}
	}

	if = {
		limit = {
			NOT = {
				exists = global_var:bank1_NofLoans
			}
		}
		set_global_variable = {
			name = bank1_NofLoans
			value = 0
		}
	}

	if = {
		limit = {
			AND = {
				NOT = {
					exists = global_var:bank1_FreeCapital
				}
				current_year < 8136
			}
		}
		set_global_variable = {
			name = bank1_FreeCapital
			value = 1500
		}
	}
	else_if = {
		limit = {
			NOT = {
				exists = global_var:bank1_FreeCapital
			}
		}
		set_global_variable = {
			name = bank1_FreeCapital
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank1_InvestmentFund
			}
		}
		set_global_variable = {
			name = bank1_InvestmentFund
			value = 0
		}
	}
	if = {
		limit = {
			AND = {
				NOT = {
					exists = global_var:bank1_NofShares
				}
				current_year < 8136
			}
		}
		set_global_variable = {
			name = bank1_NofShares
			value = 10
		}
	}
	else_if = {
		limit = {
			NOT = {
				exists = global_var:bank1_NofShares
			}
		}
		set_global_variable = {
			name = bank1_NofShares
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank1_LoanedCapital
			}
		}
		set_global_variable = {
			name = bank1_LoanedCapital
			value = 0
		}
	}
	if = {
		limit = {
			AND = {
				NOT = {
					exists = global_var:bank1_BankValue
				}
				current_year < 8136
			}
		}
		set_global_variable = {
			name = bank1_BankValue
			value = 1500
		}
	}
	else_if = {
		limit = {
			NOT = {
				exists = global_var:bank1_BankValue
			}
		}
		set_global_variable = {
			name = bank1_BankValue
			value = 0
		}
	}
	if = {
		limit = {
			AND = {
				NOT = {
					exists = global_var:bank1_ValuePerShare
				}
				current_year < 8136
			}
		}
		set_global_variable = {
			name = bank1_ValuePerShare
			value = 150
		}
	}
	else_if = {
		limit = {
			NOT = {
				exists = global_var:bank1_ValuePerShare
			}
		}
		set_global_variable = {
			name = bank1_ValuePerShare
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank1_RiskLevel
			}
		}
		set_global_variable = {
			name = bank1_RiskLevel   #low = 3, medium = 6, high = 18
			value = 6  #medium
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank1_DividendLevel
			}
		}
		set_global_variable = {
			name = bank1_DividendLevel
			value = 0.75
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank1_InterestLevel
			}
		}
		set_global_variable = {
			name = bank1_InterestLevel   #(-1, 0 +1)
			value = 1
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank1_Earnings
			}
		}
		set_global_variable = {
			name = bank1_Earnings
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank1_LostLoans
			}
		}
		set_global_variable = {
			name = bank1_LostLoans
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank1_Expenses
			}
		}
		set_global_variable = {
			name = bank1_Expenses
			value = 0
		}
	}

	#Second custom bank
	if = {
		limit = {
			NOT = {
				exists = global_var:bank2_NofDefaults
			}
		}
		set_global_variable = {
			name = bank2_NofDefaults
			value = 0
		}
	}

	if = {
		limit = {
			NOT = {
				exists = global_var:bank2_NofLoans
			}
		}
		set_global_variable = {
			name = bank2_NofLoans
			value = 0
		}
	}

	if = {
		limit = {
			NOT = {
				exists = global_var:bank2_FreeCapital
			}
		}
		set_global_variable = {
			name = bank2_FreeCapital
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank2_InvestmentFund
			}
		}
		set_global_variable = {
			name = bank2_InvestmentFund
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank2_NofShares
			}
		}
		set_global_variable = {
			name = bank2_NofShares
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank2_LoanedCapital
			}
		}
		set_global_variable = {
			name = bank2_LoanedCapital
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank2_BankValue
			}
		}
		set_global_variable = {
			name = bank2_BankValue
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank2_ValuePerShare
			}
		}
		set_global_variable = {
			name = bank2_ValuePerShare
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank2_RiskLevel
			}
		}
		set_global_variable = {
			name = bank2_RiskLevel   #low = 3, medium = 6, high = 18
			value = 6  #medium
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank2_DividendLevel
			}
		}
		set_global_variable = {
			name = bank2_DividendLevel
			value = 0.75
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank2_InterestLevel
			}
		}
		set_global_variable = {
			name = bank2_InterestLevel   #(-1, 0 +1)
			value = 1
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank2_Earnings
			}
		}
		set_global_variable = {
			name = bank2_Earnings
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank2_LostLoans
			}
		}
		set_global_variable = {
			name = bank2_LostLoans
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank2_Expenses
			}
		}
		set_global_variable = {
			name = bank2_Expenses
			value = 0
		}
	}

	#Third custom bank
	if = {
		limit = {
			NOT = {
				exists = global_var:bank3_NofDefaults
			}
		}
		set_global_variable = {
			name = bank3_NofDefaults
			value = 0
		}
	}

	if = {
		limit = {
			NOT = {
				exists = global_var:bank3_NofLoans
			}
		}
		set_global_variable = {
			name = bank3_NofLoans
			value = 0
		}
	}

	if = {
		limit = {
			NOT = {
				exists = global_var:bank3_FreeCapital
			}
		}
		set_global_variable = {
			name = bank3_FreeCapital
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank3_InvestmentFund
			}
		}
		set_global_variable = {
			name = bank3_InvestmentFund
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank3_NofShares
			}
		}
		set_global_variable = {
			name = bank3_NofShares
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank3_LoanedCapital
			}
		}
		set_global_variable = {
			name = bank3_LoanedCapital
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank3_BankValue
			}
		}
		set_global_variable = {
			name = bank3_BankValue
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank3_ValuePerShare
			}
		}
		set_global_variable = {
			name = bank3_ValuePerShare
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank3_RiskLevel
			}
		}
		set_global_variable = {
			name = bank3_RiskLevel   #low = 3, medium = 6, high = 18
			value = 6  #medium
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank3_DividendLevel
			}
		}
		set_global_variable = {
			name = bank3_DividendLevel
			value = 0.75
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank3_InterestLevel
			}
		}
		set_global_variable = {
			name = bank3_InterestLevel   #(-1, 0 +1)
			value = 1
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank3_Earnings
			}
		}
		set_global_variable = {
			name = bank3_Earnings
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank3_LostLoans
			}
		}
		set_global_variable = {
			name = bank3_LostLoans
			value = 0
		}
	}
	if = {
		limit = {
			NOT = {
				exists = global_var:bank3_Expenses
			}
		}
		set_global_variable = {
			name = bank3_Expenses
			value = 0
		}
	}


	#Distribute starting shares
	if = {
		limit = {
			has_dlc_feature = roads_to_power
		}
		if = {  # Rogare Bank
			limit = {
				current_year < 8136
			}
			title:d_nf_rogare.holder ?= {
				set_variable = {
					name = bank1_Shares
					value = 10
				}
				add_to_global_variable_list = {
					name = bank1_Shareholder
					target = this
				}
				add_to_global_variable_list = {
					name = Shareholder
					target = this
				}

				set_global_variable = {
					name = bank1_founder
					value = this
				}
				set_variable = {
					name = BankName
					value = global_var:bank1_founder
				}

				add_character_flag = bank1_Director

				#trigger_event = {
				#	id = agot_banking.0601
				#}
			}
		}

		# IB
		title:d_nf_otherys.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}

			set_global_variable = {
				name = IB_founder
				value = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}

			add_character_flag = IB_Director

			#trigger_event = {
			#	id = agot_banking.0601
			#}
		}
		title:d_nf_dothare.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_grivas.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_reyaan.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_dimittis.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_gresayn.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_fregar.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_antaryon.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_forel.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_zalyne.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_torone.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_terys.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_prestayn.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_nestoris.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_erastes.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_volentin.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_tendyris.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_velaron.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_tavellen.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_nf_gasparyon.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 5
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
	}
	else = {  # no DLC version
		#Rogare bank
		if = {  # Rogare Bank
			limit = {
				current_year < 8136
			}
			title:c_morghos.holder ?= {
				set_variable = {
					name = bank1_Shares
					value = 10
				}
				add_to_global_variable_list = {
					name = bank1_Shareholder
					target = this
				}
				add_to_global_variable_list = {
					name = Shareholder
					target = this
				}
				set_variable = {
					name = BankName
					value = global_var:bank1_founder
				}
				add_character_flag = bank1_Director

				#trigger_event = {
				#	id = agot_banking.0601
				#}
			}
		}

		# IB
		title:k_braavos.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 10
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
			add_character_flag = IB_Director

			#trigger_event = {
			#	id = agot_banking.0601
			#}
		}
		title:d_teggarlozar.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 10
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_braavosian_coastlands.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 10
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_inkolantibyr.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 10
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_lunar_bay_hills.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 10
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_mothers_crown.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 10
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:d_sweetwater.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 10
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:c_tohars_fork.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 10
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:c_mothermont.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 10
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
		title:c_noqostyos.holder ?= {
			set_variable = {
				name = IB_Shares
				value = 10
			}
			add_to_global_variable_list = {
				name = IB_Shareholder
				target = this
			}
			add_to_global_variable_list = {
				name = Shareholder
				target = this
			}
			set_variable = {
				name = BankName
				value = global_var:IB_founder
			}
		}
	}
}

agot_init_historical_loans = {
	if = {
		limit = {
			current_year >= 8294
			character:Baratheon_2 ?= { is_alive = yes }
		}
		character:Baratheon_2 ?= { historical_loan_on_game_start = yes }
	}
	if = {
		limit = {
			current_year >= 8298
			character:Baratheon_5 ?= { is_alive = yes }
		}
		character:Baratheon_5 ?= { historical_loan_on_game_start = yes }
	}
	if = {
		limit = {
			current_year >= 8300
			character:Baratheon_7 ?= { is_alive = yes }
		}
		character:Baratheon_7 ?= { historical_loan_on_game_start = yes }
	}
	if = {
		limit = {
			current_year >= 8265
			character:Waynwood_5 ?= { is_alive = yes }
		}
		character:Waynwood_5 ?= { historical_loan_on_game_start = yes }
	}
	if = {
		limit = {
			current_year >= 8262
			character:Targaryen_1 ?= { is_alive = yes }
		}
		character:Targaryen_1 ?= { historical_loan_on_game_start = yes }
	}
	if = {
		limit = {
			current_year >= 8259
			character:Targaryen_127 ?= { is_alive = yes }
		}
		character:Targaryen_127 ?= { historical_loan_on_game_start = yes }
	}
}

loan_inheritance = {
	# loan inheritance
	if = { #Loan inheritance
		limit = {
			has_character_flag = has_a_loan_flag
		}

		remove_list_global_variable = {
			name = IB_Important_Debtors
			target = this
		}
		remove_list_global_variable = {
			name = bank1_Important_Debtors
			target = this
		}
		remove_list_global_variable = {
			name = bank2_Important_Debtors
			target = this
		}
		remove_list_global_variable = {
			name = bank3_Important_Debtors
			target = this
		}

		if = { #inform default revisor
			limit = {
				has_character_flag = final_default
				NOT = { has_character_flag = assassinated }
			}

			save_scope_as = DeadDefaulter

			if = {
				limit = {
					AND = {
						has_character_flag = IB_debtor
						exists = global_var:IB_location
					}
				}
				every_in_global_list = { #inform default revisor
					variable = IB_Shareholder
					trigger_event = {
						id = agot_banking.0115
					}
				}
			}
			else_if = {
				limit = {
					AND = {
						has_character_flag = bank1_debtor
						exists = global_var:bank1_location
					}
				}
				every_in_global_list = { #inform default revisor
					variable = bank1_Shareholder
					trigger_event = {
						id = agot_banking.0115
					}
				}
			}
			else_if = {
				limit = {
					AND = {
						has_character_flag = bank2_debtor
						exists = global_var:bank2_location
					}
				}
				every_in_global_list = { #inform default revisor
					variable = bank2_Shareholder
					trigger_event = {
						id = agot_banking.0115
					}
				}
			}
			else_if = {
				limit = {
					AND = {
						has_character_flag = bank3_debtor
						exists = global_var:bank3_location
					}
				}
				every_in_global_list = { #inform default revisor
					variable = bank3_Shareholder
					trigger_event = {
						id = agot_banking.0115
					}
				}
			}
		}

		if = {
			limit = {
				exists = primary_heir
				OR = {
					AND = {
						has_character_flag = IB_debtor
						exists = global_var:IB_location
					}
					AND = {
						has_character_flag = bank1_debtor
						exists = global_var:bank1_location
					}
					AND = {
						has_character_flag = bank2_debtor
						exists = global_var:bank2_location
					}
					AND = {
						has_character_flag = bank3_debtor
						exists = global_var:bank3_location
					}
				}
			}
			save_scope_as = parent_debtor

			primary_heir = {
				if = {
					limit = {
						scope:parent_debtor = { has_character_flag = IB_debtor }
						scope:parent_debtor.var:loaned_amount >= 200
					}
					add_to_global_variable_list = {
						name = IB_Important_Debtors
						target = this
					}
				}
				else_if = {
					limit = {
						scope:parent_debtor = { has_character_flag = bank1_debtor }
						scope:parent_debtor.var:loaned_amount >= 200
					}
					add_to_global_variable_list = {
						name = bank1_Important_Debtors
						target = this
					}
				}
				else_if = {
					limit = {
						scope:parent_debtor = { has_character_flag = bank2_debtor }
						scope:parent_debtor.var:loaned_amount >= 200
					}
					add_to_global_variable_list = {
						name = bank2_Important_Debtors
						target = this
					}
				}
				else_if = {
					limit = {
						scope:parent_debtor = { has_character_flag = bank3_debtor }
						scope:parent_debtor.var:loaned_amount >= 200
					}
					add_to_global_variable_list = {
						name = bank3_Important_Debtors
						target = this
					}
				}
				if = { #If heir also has a loan the parents values are just added to the running loan and no special loan-becomes-due event is triggered
					limit = {
						has_character_flag = has_a_loan_flag
						OR = {
							AND = {
								scope:parent_debtor = { has_character_flag = IB_debtor }
								has_character_flag = IB_debtor
							}
							AND = {
								scope:parent_debtor = { has_character_flag = bank1_debtor }
								has_character_flag = bank1_debtor
							}
							AND = {
								scope:parent_debtor = { has_character_flag = bank2_debtor }
								has_character_flag = bank2_debtor
							}
							AND = {
								scope:parent_debtor = { has_character_flag = bank3_debtor }
								has_character_flag = bank3_debtor
							}
						}
					}
					if = {
						limit = {
							scope:parent_debtor = { has_character_flag = final_default }
						}

						if = {
							limit = {
								scope:parent_debtor = { has_character_flag = IB_debtor }
							}
							if = {
								limit = {
									global_var:IB_LostLoans >= scope:parent_debtor.var:loaned_amount
								}
								change_global_variable = {
									name = IB_LostLoans
									subtract = scope:parent_debtor.var:loaned_amount
								}
							}
							else = {
								set_global_variable = {
									name = IB_LostLoans
									value = 0
								}
							}

							change_global_variable = {
								name = IB_LoanedCapital
								add = scope:parent_debtor.var:loaned_amount
							}
							change_global_variable = {
								name = IB_BankValue
								add = scope:parent_debtor.var:loaned_amount
							}
						}
						else_if = {
							limit = {
								scope:parent_debtor = { has_character_flag = bank1_debtor }
							}
							if = {
								limit = {
									global_var:bank1_LostLoans >= scope:parent_debtor.var:loaned_amount
								}
								change_global_variable = {
									name = bank1_LostLoans
									subtract = scope:parent_debtor.var:loaned_amount
								}
							}
							else = {
								set_global_variable = {
									name = bank1_LostLoans
									value = 0
								}
							}

							change_global_variable = {
								name = bank1_LoanedCapital
								add = scope:parent_debtor.var:loaned_amount
							}
							change_global_variable = {
								name = bank1_BankValue
								add = scope:parent_debtor.var:loaned_amount
							}
						}
						else_if = {
							limit = {
								scope:parent_debtor = { has_character_flag = bank2_debtor }
							}
							if = {
								limit = {
									global_var:bank2_LostLoans >= scope:parent_debtor.var:loaned_amount
								}
								change_global_variable = {
									name = bank2_LostLoans
									subtract = scope:parent_debtor.var:loaned_amount
								}
							}
							else = {
								set_global_variable = {
									name = bank2_LostLoans
									value = 0
								}
							}

							change_global_variable = {
								name = bank2_LoanedCapital
								add = scope:parent_debtor.var:loaned_amount
							}
							change_global_variable = {
								name = bank2_BankValue
								add = scope:parent_debtor.var:loaned_amount
							}
						}
						else_if = {
							limit = {
								scope:parent_debtor = { has_character_flag = bank3_debtor }
							}
							if = {
								limit = {
									global_var:bank3_LostLoans >= scope:parent_debtor.var:loaned_amount
								}
								change_global_variable = {
									name = bank3_LostLoans
									subtract = scope:parent_debtor.var:loaned_amount
								}
							}
							else = {
								set_global_variable = {
									name = bank3_LostLoans
									value = 0
								}
							}

							change_global_variable = {
								name = bank3_LoanedCapital
								add = scope:parent_debtor.var:loaned_amount
							}
							change_global_variable = {
								name = bank3_BankValue
								add = scope:parent_debtor.var:loaned_amount
							}
						}
					}

					change_variable = {
						name = total_repayment
						add = scope:parent_debtor.var:total_repayment
					}

					change_variable = {
						name = half_repayment
						add = scope:parent_debtor.var:half_repayment
					}

					change_variable = {
						name = loaned_amount
						add = scope:parent_debtor.var:loaned_amount
					}

					change_variable = {
						name = payable_interest
						add = scope:parent_debtor.var:payable_interest
					}

					trigger_event = {
						id = agot_banking.0006
					}
				}
				else_if = { # heir has a loan but with a different bank = this loan is lost
					limit = {
						has_character_flag = has_a_loan_flag
					}
					scope:parent_debtor = {
						if = {
							limit = {
								NOT = { has_character_flag = final_default }
							}
							if = {
								limit = {
									has_character_flag = IB_debtor
								}
								change_global_variable = {
									name = IB_LostLoans
									add = var:loaned_amount
								}
								change_global_variable = {
									name = IB_LoanedCapital
									subtract = var:loaned_amount
								}
								change_global_variable = {
									name = IB_BankValue
									subtract = var:loaned_amount
								}
							}
							else_if = {
								limit = {
									has_character_flag = bank1_debtor
								}
								change_global_variable = {
									name = bank1_LostLoans
									add = var:loaned_amount
								}
								change_global_variable = {
									name = bank1_LoanedCapital
									subtract = var:loaned_amount
								}
								change_global_variable = {
									name = bank1_BankValue
									subtract = var:loaned_amount
								}
							}
							else_if = {
								limit = {
									has_character_flag = bank2_debtor
								}
								change_global_variable = {
									name = bank2_LostLoans
									add = var:loaned_amount
								}
								change_global_variable = {
									name = bank2_LoanedCapital
									subtract = var:loaned_amount
								}
								change_global_variable = {
									name = bank2_BankValue
									subtract = var:loaned_amount
								}
							}
							else_if = {
								limit = {
									has_character_flag = bank3_debtor
								}
								change_global_variable = {
									name = bank3_LostLoans
									add = var:loaned_amount
								}
								change_global_variable = {
									name = bank3_LoanedCapital
									subtract = var:loaned_amount
								}
								change_global_variable = {
									name = bank3_BankValue
									subtract = var:loaned_amount
								}
							}
						}
					}
				}
				else = { #heir had no loan: Takes over from parent and repayment is triggered immediatley
					add_character_flag = has_a_loan_flag

					if = {
						limit = {
							scope:parent_debtor = { has_character_flag = IB_debtor }
						}
						add_character_flag = IB_debtor
					}
					else_if = {
						limit = {
							scope:parent_debtor = { has_character_flag = bank1_debtor }
						}
						add_character_flag = bank1_debtor
					}
					else_if = {
						limit = {
							scope:parent_debtor = { has_character_flag = bank2_debtor }
						}
						add_character_flag = bank2_debtor
					}
					else_if = {
						limit = {
							scope:parent_debtor = { has_character_flag = bank3_debtor }
						}
						add_character_flag = bank3_debtor
					}


					if = {
						limit = {
							scope:parent_debtor = { has_character_flag = final_default }
						}

						if = {
							limit = {
								scope:parent_debtor = { has_character_flag = IB_debtor }
							}
							if = {
								limit = {
									global_var:IB_LostLoans >= scope:parent_debtor.var:loaned_amount
								}
								change_global_variable = {
									name = IB_LostLoans
									subtract = scope:parent_debtor.var:loaned_amount
								}
							}
							else = {
								set_global_variable = {
									name = IB_LostLoans
									value = 0
								}
							}

							change_global_variable = {
								name = IB_LoanedCapital
								add = scope:parent_debtor.var:loaned_amount
							}
							change_global_variable = {
								name = IB_BankValue
								add = scope:parent_debtor.var:loaned_amount
							}
						}
						else_if = {
							limit = {
								scope:parent_debtor = { has_character_flag = bank1_debtor }
							}
							if = {
								limit = {
									global_var:bank1_LostLoans >= scope:parent_debtor.var:loaned_amount
								}
								change_global_variable = {
									name = bank1_LostLoans
									subtract = scope:parent_debtor.var:loaned_amount
								}
							}
							else = {
								set_global_variable = {
									name = bank1_LostLoans
									value = 0
								}
							}

							change_global_variable = {
								name = bank1_LoanedCapital
								add = scope:parent_debtor.var:loaned_amount
							}
							change_global_variable = {
								name = bank1_BankValue
								add = scope:parent_debtor.var:loaned_amount
							}
						}
						else_if = {
							limit = {
								scope:parent_debtor = { has_character_flag = bank2_debtor }
							}
							if = {
								limit = {
									global_var:bank2_LostLoans >= scope:parent_debtor.var:loaned_amount
								}
								change_global_variable = {
									name = bank2_LostLoans
									subtract = scope:parent_debtor.var:loaned_amount
								}
							}
							else = {
								set_global_variable = {
									name = bank2_LostLoans
									value = 0
								}
							}

							change_global_variable = {
								name = bank2_LoanedCapital
								add = scope:parent_debtor.var:loaned_amount
							}
							change_global_variable = {
								name = bank2_BankValue
								add = scope:parent_debtor.var:loaned_amount
							}
						}
						else_if = {
							limit = {
								scope:parent_debtor = { has_character_flag = bank3_debtor }
							}
							if = {
								limit = {
									global_var:bank3_LostLoans >= scope:parent_debtor.var:loaned_amount
								}
								change_global_variable = {
									name = bank3_LostLoans
									subtract = scope:parent_debtor.var:loaned_amount
								}
							}
							else = {
								set_global_variable = {
									name = bank3_LostLoans
									value = 0
								}
							}

							change_global_variable = {
								name = bank3_LoanedCapital
								add = scope:parent_debtor.var:loaned_amount
							}
							change_global_variable = {
								name = bank3_BankValue
								add = scope:parent_debtor.var:loaned_amount
							}
						}
					}

					set_variable = {
						name = total_repayment
						value = scope:parent_debtor.var:total_repayment
					}

					set_variable = {
						name = half_repayment
						value = scope:parent_debtor.var:half_repayment
					}

					set_variable = {
						name = loaned_amount
						value = scope:parent_debtor.var:loaned_amount
					}

					set_variable = {
						name = loan_term
						value = scope:parent_debtor.var:loan_term
					}

					set_variable = {
						name = loan_interest_rate
						value = scope:parent_debtor.var:loan_interest_rate
					}

					set_variable = {
						name = payable_interest
						value = scope:parent_debtor.var:payable_interest
					}

					set_variable = {
						name = credit_score
						value = scope:parent_debtor.var:credit_score
					}

					create_story = {
						type = story_agot_loan
					}

					trigger_event = {
						id = agot_banking.0007
					}

					trigger_event = {
						id = agot_banking.0004
						days = 10
					}
				}
			}
		}
		else = { #no heir means the loan is lost (if it wasn't lost already)
			if = {
				limit = {
					NOT = { has_character_flag = final_default }
					OR = {
						AND = {
							has_character_flag = IB_debtor
							exists = global_var:IB_location
						}
						AND = {
							has_character_flag = bank1_debtor
							exists = global_var:bank1_location
						}
						AND = {
							has_character_flag = bank2_debtor
							exists = global_var:bank2_location
						}
						AND = {
							has_character_flag = bank3_debtor
							exists = global_var:bank3_location
						}
					}
				}

				if = {
					limit = {
						has_character_flag = IB_debtor
					}
					change_global_variable = {
						name = IB_LostLoans
						add = var:loaned_amount
					}
					change_global_variable = {
						name = IB_LoanedCapital
						subtract = var:loaned_amount
					}
					change_global_variable = {
						name = IB_BankValue
						subtract = var:loaned_amount
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank1_debtor
					}
					change_global_variable = {
						name = bank1_LostLoans
						add = var:loaned_amount
					}
					change_global_variable = {
						name = bank1_LoanedCapital
						subtract = var:loaned_amount
					}
					change_global_variable = {
						name = bank1_BankValue
						subtract = var:loaned_amount
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank2_debtor
					}
					change_global_variable = {
						name = bank2_LostLoans
						add = var:loaned_amount
					}
					change_global_variable = {
						name = bank2_LoanedCapital
						subtract = var:loaned_amount
					}
					change_global_variable = {
						name = bank2_BankValue
						subtract = var:loaned_amount
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank3_debtor
					}
					change_global_variable = {
						name = bank3_LostLoans
						add = var:loaned_amount
					}
					change_global_variable = {
						name = bank3_LoanedCapital
						subtract = var:loaned_amount
					}
					change_global_variable = {
						name = bank3_BankValue
						subtract = var:loaned_amount
					}
				}
			}
		}

		set_variable = {
			name = total_repayment
			value = 0
		}
		set_variable = {
			name = half_repayment
			value = 0
		}
		set_variable = {
			name = payable_interest
			value = 0
		}
		set_variable = {
			name = loaned_amount
			value = 0
		}
		set_variable = {
			name = loan_interest_rate
			value = 0
		}
		set_variable = {
			name = loan_term
			value = 0
		}

		random_owned_story = {
			limit = {
				story_type = story_agot_loan
			}
			end_story = yes
		}

		remove_character_flag = has_a_loan_flag
		remove_character_flag = agot_loan_high_long
		remove_character_flag = agot_loan_high_short
		remove_character_flag = agot_loan_low_long
		remove_character_flag = agot_loan_low_short
		remove_character_flag = IB_debtor
		remove_character_flag = bank1_debtor
		remove_character_flag = bank2_debtor
		remove_character_flag = bank3_debtor
	}
}

share_inheritance = {
	# Bank shares inheritance
	if = { #Share inheritance
		limit = {
			has_variable = IB_Shares
			var:IB_Shares > 0
		}
		if = {
			limit = {
				exists = player_heir
				player_heir = { is_alive = yes }
			}

			save_scope_as = parent_shareholder

			player_heir = {
				if = {
					limit = {
						has_variable = IB_Shares
					}
					change_variable = {
						name = IB_Shares
						add = scope:parent_shareholder.var:IB_Shares
					}
				}
				else = {
					set_variable = {
						name = IB_Shares
						value = scope:parent_shareholder.var:IB_Shares
					}
					add_to_global_variable_list = {
						name = IB_Shareholder
						target = this
					}
					add_to_global_variable_list = {
						name = Shareholder
						target = this
					}
					set_variable = {
						name = BankName
						value = global_var:IB_founder
					}
				}

				if = {
					limit = {
						scope:parent_shareholder = { has_character_flag = investments_forbidden }
					}
					add_character_flag = investments_forbidden
				}
			}
		}
		else_if = {
			limit = {
				exists = primary_heir
				primary_heir = { is_alive = yes }
			}

			save_scope_as = parent_shareholder

			primary_heir = {
				if = {
					limit = {
						has_variable = IB_Shares
					}
					change_variable = {
						name = IB_Shares
						add = scope:parent_shareholder.var:IB_Shares
					}
				}
				else = {
					set_variable = {
						name = IB_Shares
						value = scope:parent_shareholder.var:IB_Shares
					}
					add_to_global_variable_list = {
						name = IB_Shareholder
						target = this
					}
					add_to_global_variable_list = {
						name = Shareholder
						target = this
					}
					set_variable = {
						name = BankName
						value = global_var:IB_founder
					}
				}
			}
		}
		else_if = {
			limit = {
				any_child = {
					is_alive = yes
					count > 0
				}
			}

			save_scope_as = parent_shareholder

			every_child = {
				if = {
					limit = { # oldest child
						is_alive = yes
						NOT = {
							any_sibling = {
								is_alive = yes
								age > PREV.age
							}
						}
					}
					if = {
						limit = {
							has_variable = IB_Shares
						}
						change_variable = {
							name = IB_Shares
							add = scope:parent_shareholder.var:IB_Shares
						}
					}
					else = {
						set_variable = {
							name = IB_Shares
							value = scope:parent_shareholder.var:IB_Shares
						}
						add_to_global_variable_list = {
							name = IB_Shareholder
							target = this
						}
						add_to_global_variable_list = {
							name = Shareholder
							target = this
						}
						set_variable = {
							name = BankName
							value = global_var:IB_founder
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				exists = liege
				liege = { is_alive = yes }
			}

			save_scope_as = parent_shareholder

			liege = {
				if = {
					limit = {
						has_variable = IB_Shares
					}
					change_variable = {
						name = IB_Shares
						add = scope:parent_shareholder.var:IB_Shares
					}
				}
				else = {
					set_variable = {
						name = IB_Shares
						value = scope:parent_shareholder.var:IB_Shares
					}
					add_to_global_variable_list = {
						name = IB_Shareholder
						target = this
					}
					add_to_global_variable_list = {
						name = Shareholder
						target = this
					}
					set_variable = {
						name = BankName
						value = global_var:IB_founder
					}
				}
			}
		}
		else_if = {
			limit = {
				exists = primary_spouse
				primary_spouse = { is_alive = yes }
			}

			save_scope_as = parent_shareholder

			primary_spouse = {
				if = {
					limit = {
						has_variable = IB_Shares
					}
					change_variable = {
						name = IB_Shares
						add = scope:parent_shareholder.var:IB_Shares
					}
				}
				else = {
					set_variable = {
						name = IB_Shares
						value = scope:parent_shareholder.var:IB_Shares
					}
					add_to_global_variable_list = {
						name = IB_Shareholder
						target = this
					}
					add_to_global_variable_list = {
						name = Shareholder
						target = this
					}
					set_variable = {
						name = BankName
						value = global_var:IB_founder
					}
				}
			}
		}
		else = {
			change_global_variable = {
				name = IB_NofShares
				subtract = var:IB_Shares
			}
		}

		remove_list_global_variable = {
			name = IB_Shareholder
			target = this
		}
		remove_list_global_variable = {
			name = Shareholder
			target = this
		}

		set_variable = {
			name = IB_Shares
			value = 0
		}
	}

	else_if = { #Share inheritance
		limit = {
			has_variable = bank1_Shares
			var:bank1_Shares > 0
		}
		if = {
			limit = {
				exists = player_heir
				player_heir = { is_alive = yes }
			}

			save_scope_as = parent_shareholder

			player_heir = {
				if = {
					limit = {
						has_variable = bank1_Shares
					}
					change_variable = {
						name = bank1_Shares
						add = scope:parent_shareholder.var:bank1_Shares
					}
				}
				else = {
					set_variable = {
						name = bank1_Shares
						value = scope:parent_shareholder.var:bank1_Shares
					}
					add_to_global_variable_list = {
						name = bank1_Shareholder
						target = this
					}
					add_to_global_variable_list = {
						name = Shareholder
						target = this
					}
					set_variable = {
						name = BankName
						value = global_var:bank1_founder
					}
				}

				if = {
					limit = {
						scope:parent_shareholder = { has_character_flag = investments_forbidden }
					}
					add_character_flag = investments_forbidden
				}
			}
		}
		else_if = {
			limit = {
				exists = primary_heir
				primary_heir = { is_alive = yes }
			}

			save_scope_as = parent_shareholder

			primary_heir = {
				if = {
					limit = {
						has_variable = bank1_Shares
					}
					change_variable = {
						name = bank1_Shares
						add = scope:parent_shareholder.var:bank1_Shares
					}
				}
				else = {
					set_variable = {
						name = bank1_Shares
						value = scope:parent_shareholder.var:bank1_Shares
					}
					add_to_global_variable_list = {
						name = bank1_Shareholder
						target = this
					}
					add_to_global_variable_list = {
						name = Shareholder
						target = this
					}
					set_variable = {
						name = BankName
						value = global_var:bank1_founder
					}
				}
			}
		}
		else_if = {
			limit = {
				any_child = {
					is_alive = yes
					count > 0
				}
			}

			save_scope_as = parent_shareholder

			every_child = {
				if = {
					limit = { # oldest child
						is_alive = yes
						NOT = {
							any_sibling = {
								is_alive = yes
								age > PREV.age
							}
						}
					}
					if = {
						limit = {
							has_variable = bank1_Shares
						}
						change_variable = {
							name = bank1_Shares
							add = scope:parent_shareholder.var:bank1_Shares
						}
					}
					else = {
						set_variable = {
							name = bank1_Shares
							value = scope:parent_shareholder.var:bank1_Shares
						}
						add_to_global_variable_list = {
							name = bank1_Shareholder
							target = this
						}
						add_to_global_variable_list = {
							name = Shareholder
							target = this
						}
						set_variable = {
							name = BankName
							value = global_var:bank1_founder
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				exists = primary_spouse
				primary_spouse = { is_alive = yes }
			}

			save_scope_as = parent_shareholder

			primary_spouse = {
				if = {
					limit = {
						has_variable = bank1_Shares
					}
					change_variable = {
						name = bank1_Shares
						add = scope:parent_shareholder.var:bank1_Shares
					}
				}
				else = {
					set_variable = {
						name = bank1_Shares
						value = scope:parent_shareholder.var:bank1_Shares
					}
					add_to_global_variable_list = {
						name = bank1_Shareholder
						target = this
					}
					add_to_global_variable_list = {
						name = Shareholder
						target = this
					}
					set_variable = {
						name = BankName
						value = global_var:bank1_founder
					}
				}
			}
		}
		else_if = {
			limit = {
				exists = liege
				liege = { is_alive = yes }
			}

			save_scope_as = parent_shareholder

			liege = {
				if = {
					limit = {
						has_variable = bank1_Shares
					}
					change_variable = {
						name = bank1_Shares
						add = scope:parent_shareholder.var:bank1_Shares
					}
				}
				else = {
					set_variable = {
						name = bank1_Shares
						value = scope:parent_shareholder.var:bank1_Shares
					}
					add_to_global_variable_list = {
						name = bank1_Shareholder
						target = this
					}
					add_to_global_variable_list = {
						name = Shareholder
						target = this
					}
					set_variable = {
						name = BankName
						value = global_var:bank1_founder
					}
				}
			}
		}
		else = {
			change_global_variable = {
				name = bank1_NofShares
				subtract = var:bank1_Shares
			}
		}

		remove_list_global_variable = {
			name = bank1_Shareholder
			target = this
		}
		remove_list_global_variable = {
			name = Shareholder
			target = this
		}

		set_variable = {
			name = bank1_Shares
			value = 0
		}
	}

	else_if = { #Share inheritance
		limit = {
			has_variable = bank2_Shares
			var:bank2_Shares > 0
		}
		if = {
			limit = {
				exists = player_heir
				player_heir = { is_alive = yes }
			}

			save_scope_as = parent_shareholder

			player_heir = {
				if = {
					limit = {
						has_variable = bank2_Shares
					}
					change_variable = {
						name = bank2_Shares
						add = scope:parent_shareholder.var:bank2_Shares
					}
				}
				else = {
					set_variable = {
						name = bank2_Shares
						value = scope:parent_shareholder.var:bank2_Shares
					}
					add_to_global_variable_list = {
						name = bank2_Shareholder
						target = this
					}
					add_to_global_variable_list = {
						name = Shareholder
						target = this
					}
					set_variable = {
						name = BankName
						value = global_var:bank2_founder
					}
				}

				if = {
					limit = {
						scope:parent_shareholder = { has_character_flag = investments_forbidden }
					}
					add_character_flag = investments_forbidden
				}
			}
		}
		else_if = {
			limit = {
				exists = primary_heir
				primary_heir = { is_alive = yes }
			}

			save_scope_as = parent_shareholder

			primary_heir = {
				if = {
					limit = {
						has_variable = bank2_Shares
					}
					change_variable = {
						name = bank2_Shares
						add = scope:parent_shareholder.var:bank2_Shares
					}
				}
				else = {
					set_variable = {
						name = bank2_Shares
						value = scope:parent_shareholder.var:bank2_Shares
					}
					add_to_global_variable_list = {
						name = bank2_Shareholder
						target = this
					}
					add_to_global_variable_list = {
						name = Shareholder
						target = this
					}
					set_variable = {
						name = BankName
						value = global_var:bank2_founder
					}
				}
			}
		}
		else_if = {
			limit = {
				any_child = {
					is_alive = yes
					count > 0
				}
			}

			save_scope_as = parent_shareholder

			every_child = {
				if = {
					limit = { # oldest child
						is_alive = yes
						NOT = {
							any_sibling = {
								is_alive = yes
								age > PREV.age
							}
						}
					}
					if = {
						limit = {
							has_variable = bank2_Shares
						}
						change_variable = {
							name = bank2_Shares
							add = scope:parent_shareholder.var:bank2_Shares
						}
					}
					else = {
						set_variable = {
							name = bank2_Shares
							value = scope:parent_shareholder.var:bank2_Shares
						}
						add_to_global_variable_list = {
							name = bank2_Shareholder
							target = this
						}
						add_to_global_variable_list = {
							name = Shareholder
							target = this
						}
						set_variable = {
							name = BankName
							value = global_var:bank2_founder
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				exists = primary_spouse
				primary_spouse = { is_alive = yes }
			}

			save_scope_as = parent_shareholder

			primary_spouse = {
				if = {
					limit = {
						has_variable = bank2_Shares
					}
					change_variable = {
						name = bank2_Shares
						add = scope:parent_shareholder.var:bank2_Shares
					}
				}
				else = {
					set_variable = {
						name = bank2_Shares
						value = scope:parent_shareholder.var:bank2_Shares
					}
					add_to_global_variable_list = {
						name = bank2_Shareholder
						target = this
					}
					add_to_global_variable_list = {
						name = Shareholder
						target = this
					}
					set_variable = {
						name = BankName
						value = global_var:bank2_founder
					}
				}
			}
		}
		else_if = {
			limit = {
				exists = liege
				liege = { is_alive = yes }
			}

			save_scope_as = parent_shareholder

			liege = {
				if = {
					limit = {
						has_variable = bank2_Shares
					}
					change_variable = {
						name = bank2_Shares
						add = scope:parent_shareholder.var:bank2_Shares
					}
				}
				else = {
					set_variable = {
						name = bank2_Shares
						value = scope:parent_shareholder.var:bank2_Shares
					}
					add_to_global_variable_list = {
						name = bank2_Shareholder
						target = this
					}
					add_to_global_variable_list = {
						name = Shareholder
						target = this
					}
					set_variable = {
						name = BankName
						value = global_var:bank2_founder
					}
				}
			}
		}
		else = {
			change_global_variable = {
				name = bank2_NofShares
				subtract = var:bank2_Shares
			}
		}

		remove_list_global_variable = {
			name = bank2_Shareholder
			target = this
		}
		remove_list_global_variable = {
			name = Shareholder
			target = this
		}

		set_variable = {
			name = bank2_Shares
			value = 0
		}
	}

	else_if = { #Share inheritance
		limit = {
			has_variable = bank3_Shares
			var:bank3_Shares > 0
		}
		if = {
			limit = {
				exists = player_heir
				player_heir = { is_alive = yes }
			}

			save_scope_as = parent_shareholder

			player_heir = {
				if = {
					limit = {
						has_variable = bank3_Shares
					}
					change_variable = {
						name = bank3_Shares
						add = scope:parent_shareholder.var:bank3_Shares
					}
				}
				else = {
					set_variable = {
						name = bank3_Shares
						value = scope:parent_shareholder.var:bank3_Shares
					}
					add_to_global_variable_list = {
						name = bank3_Shareholder
						target = this
					}
					add_to_global_variable_list = {
						name = Shareholder
						target = this
					}
					set_variable = {
						name = BankName
						value = global_var:bank3_founder
					}
				}

				if = {
					limit = {
						scope:parent_shareholder = { has_character_flag = investments_forbidden }
					}
					add_character_flag = investments_forbidden
				}
			}
		}
		else_if = {
			limit = {
				exists = primary_heir
				primary_heir = { is_alive = yes }
			}

			save_scope_as = parent_shareholder

			primary_heir = {
				if = {
					limit = {
						has_variable = bank3_Shares
					}
					change_variable = {
						name = bank3_Shares
						add = scope:parent_shareholder.var:bank3_Shares
					}
				}
				else = {
					set_variable = {
						name = bank3_Shares
						value = scope:parent_shareholder.var:bank3_Shares
					}
					add_to_global_variable_list = {
						name = bank3_Shareholder
						target = this
					}
					add_to_global_variable_list = {
						name = Shareholder
						target = this
					}
					set_variable = {
						name = BankName
						value = global_var:bank3_founder
					}
				}
			}
		}
		else_if = {
			limit = {
				any_child = {
					is_alive = yes
					count > 0
				}
			}

			save_scope_as = parent_shareholder

			every_child = {
				if = {
					limit = { # oldest child
						is_alive = yes
						NOT = {
							any_sibling = {
								is_alive = yes
								age > PREV.age
							}
						}
					}
					if = {
						limit = {
							has_variable = bank3_Shares
						}
						change_variable = {
							name = bank3_Shares
							add = scope:parent_shareholder.var:bank3_Shares
						}
					}
					else = {
						set_variable = {
							name = bank3_Shares
							value = scope:parent_shareholder.var:bank3_Shares
						}
						add_to_global_variable_list = {
							name = bank3_Shareholder
							target = this
						}
						add_to_global_variable_list = {
							name = Shareholder
							target = this
						}
						set_variable = {
							name = BankName
							value = global_var:bank3_founder
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				exists = primary_spouse
				primary_spouse = { is_alive = yes }
			}

			save_scope_as = parent_shareholder

			primary_spouse = {
				if = {
					limit = {
						has_variable = bank3_Shares
					}
					change_variable = {
						name = bank3_Shares
						add = scope:parent_shareholder.var:bank3_Shares
					}
				}
				else = {
					set_variable = {
						name = bank3_Shares
						value = scope:parent_shareholder.var:bank3_Shares
					}
					add_to_global_variable_list = {
						name = bank3_Shareholder
						target = this
					}
					add_to_global_variable_list = {
						name = Shareholder
						target = this
					}
					set_variable = {
						name = BankName
						value = global_var:bank3_founder
					}
				}
			}
		}
		else_if = {
			limit = {
				exists = liege
				liege = { is_alive = yes }
			}

			save_scope_as = parent_shareholder

			liege = {
				if = {
					limit = {
						has_variable = bank3_Shares
					}
					change_variable = {
						name = bank3_Shares
						add = scope:parent_shareholder.var:bank3_Shares
					}
				}
				else = {
					set_variable = {
						name = bank3_Shares
						value = scope:parent_shareholder.var:bank3_Shares
					}
					add_to_global_variable_list = {
						name = bank3_Shareholder
						target = this
					}
					add_to_global_variable_list = {
						name = Shareholder
						target = this
					}
					set_variable = {
						name = BankName
						value = global_var:bank3_founder
					}
				}
			}
		}
		else = {
			change_global_variable = {
				name = bank3_NofShares
				subtract = var:bank3_Shares
			}
		}

		remove_list_global_variable = {
			name = bank3_Shareholder
			target = this
		}
		remove_list_global_variable = {
			name = Shareholder
			target = this
		}

		set_variable = {
			name = bank3_Shares
			value = 0
		}
	}
}

bank_director_election = {
	# Bank director dies, new one is selected among shareholders
	if = {
		limit = {
			OR = {
				has_character_flag = IB_Director
				has_character_flag = bank1_Director
				has_character_flag = bank2_Director
				has_character_flag = bank3_Director
			}
		}

		save_scope_as = dead_director

		if = {
			limit = {
				has_character_flag = IB_Director
			}
			remove_character_flag = IB_Director
			ordered_in_global_list = { # prepare director election candidates
				variable = IB_Shareholder
				limit = {
					is_alive = yes
					NOT = { this = scope:dead_director }
					OR = {
						is_adult = yes
						NOT = {
							any_in_global_list = {
								variable = IB_Shareholder
								is_adult = yes
							}
						}
					}
				}
				order_by = {
					value = var:IB_Shares
					if = { # avoid kid-directors when possible
						limit = { is_adult = no }
						multiply = 0
					}
					if = { # avoid incapable directors when possible
						limit = { is_incapable = yes }
						multiply = 0
					}
				}
				max = 4

				set_variable = {
					name = director_votes
					value = 0
				}

				if = {
					limit = {
						NOT = { exists = scope:director_candidate1 }
					}
					save_scope_as = director_candidate1
				}
				else_if = {
					limit = {
						NOT = { exists = scope:director_candidate2 }
					}
					save_scope_as = director_candidate2
				}
				else_if = {
					limit = {
						NOT = { exists = scope:director_candidate3 }
					}
					save_scope_as = director_candidate3
				}
				else = { save_scope_as = director_candidate4 }
			}

			every_in_global_list = { # ask shareholders for their vote
				variable = IB_Shareholder

				limit = {
					has_variable = IB_Shares
					var:IB_Shares > 0
					is_alive = yes
					NOT = { this = scope:dead_director }
				}

				trigger_event = {
					id = agot_banking.0215
					days = 1
				}
			}

			random_in_global_list = { #determine election winner
				variable = IB_Shareholder
				limit = {
					is_alive = yes
				}

				if = {
					limit = {
						has_multiple_players = no
					}
					trigger_event = {
						id = agot_banking.0225
						days = 2
					}
				}
				else = {
					trigger_event = {
						id = agot_banking.0225
						days = 6
					}
				}
			}
		}

		else_if = {
			limit = {
				has_character_flag = bank1_Director
			}
			remove_character_flag = bank1_Director
			ordered_in_global_list = { # prepare director election candidates
				variable = bank1_Shareholder
				limit = {
					is_alive = yes
					NOT = { this = scope:dead_director }
					OR = {
						is_adult = yes
						NOT = {
							any_in_global_list = {
								variable = bank1_Shareholder
								is_adult = yes
							}
						}
					}
				}
				order_by = {
					value = var:bank1_Shares
					if = { # avoid kid-directors when possible
						limit = { is_adult = no }
						multiply = 0
					}
					if = { # avoid incapable directors when possible
						limit = { is_incapable = yes }
						multiply = 0
					}
				}
				max = 4

				set_variable = {
					name = director_votes
					value = 0
				}

				if = {
					limit = {
						NOT = { exists = scope:director_candidate1 }
					}
					save_scope_as = director_candidate1
				}
				else_if = {
					limit = {
						NOT = { exists = scope:director_candidate2 }
					}
					save_scope_as = director_candidate2
				}
				else_if = {
					limit = {
						NOT = { exists = scope:director_candidate3 }
					}
					save_scope_as = director_candidate3
				}
				else = { save_scope_as = director_candidate4 }
			}

			every_in_global_list = { # ask shareholders for their vote
				variable = bank1_Shareholder

				limit = {
					#NOT = { has_character_flag = bank1_voted }
					has_variable = bank1_Shares
					var:bank1_Shares > 0
					is_alive = yes
					NOT = { this = scope:dead_director }
				}

				trigger_event = {
					id = agot_banking.0215
					days = 1
				}
			}

			random_in_global_list = { #determine election winner
				variable = bank1_Shareholder
				limit = {
					is_alive = yes
				}

				if = {
					limit = {
						has_multiple_players = no
					}
					trigger_event = {
						id = agot_banking.0225
						days = 2
					}
				}
				else = {
					trigger_event = {
						id = agot_banking.0225
						days = 6
					}
				}
			}
		}

		else_if = {
			limit = {
				has_character_flag = bank2_Director
			}
			remove_character_flag = bank2_Director
			ordered_in_global_list = { # prepare director election candidates
				variable = bank2_Shareholder
				limit = {
					is_alive = yes
					NOT = { this = scope:dead_director }
					OR = {
						is_adult = yes
						NOT = {
							any_in_global_list = {
								variable = bank2_Shareholder
								is_adult = yes
							}
						}
					}
				}
				order_by = {
					value = var:bank2_Shares
					if = { # avoid kid-directors when possible
						limit = { is_adult = no }
						multiply = 0
					}
					if = { # avoid incapable directors when possible
						limit = { is_incapable = yes }
						multiply = 0
					}
				}
				max = 4

				set_variable = {
					name = director_votes
					value = 0
				}

				if = {
					limit = {
						NOT = { exists = scope:director_candidate1 }
					}
					save_scope_as = director_candidate1
				}
				else_if = {
					limit = {
						NOT = { exists = scope:director_candidate2 }
					}
					save_scope_as = director_candidate2
				}
				else_if = {
					limit = {
						NOT = { exists = scope:director_candidate3 }
					}
					save_scope_as = director_candidate3
				}
				else = { save_scope_as = director_candidate4 }
			}

			every_in_global_list = { # ask shareholders for their vote
				variable = bank2_Shareholder

				limit = {
					#NOT = { has_character_flag = bank2_voted }
					has_variable = bank2_Shares
					var:bank2_Shares > 0
					is_alive = yes
					NOT = { this = scope:dead_director }
				}

				trigger_event = {
					id = agot_banking.0215
					days = 1
				}
			}

			random_in_global_list = { #determine election winner
				variable = bank2_Shareholder
				limit = {
					is_alive = yes
				}

				if = {
					limit = {
						has_multiple_players = no
					}
					trigger_event = {
						id = agot_banking.0225
						days = 2
					}
				}
				else = {
					trigger_event = {
						id = agot_banking.0225
						days = 6
					}
				}
			}
		}

		else_if = {
			limit = {
				has_character_flag = bank3_Director
			}
			remove_character_flag = bank3_Director
			ordered_in_global_list = { # prepare director election candidates
				variable = bank3_Shareholder
				limit = {
					is_alive = yes
					NOT = { this = scope:dead_director }
					OR = {
						is_adult = yes
						NOT = {
							any_in_global_list = {
								variable = bank3_Shareholder
								is_adult = yes
							}
						}
					}
				}
				order_by = {
					value = var:bank3_Shares
					if = { # avoid kid-directors when possible
						limit = { is_adult = no }
						multiply = 0
					}
					if = { # avoid incapable directors when possible
						limit = { is_incapable = yes }
						multiply = 0
					}
				}
				max = 4

				set_variable = {
					name = director_votes
					value = 0
				}

				if = {
					limit = {
						NOT = { exists = scope:director_candidate1 }
					}
					save_scope_as = director_candidate1
				}
				else_if = {
					limit = {
						NOT = { exists = scope:director_candidate2 }
					}
					save_scope_as = director_candidate2
				}
				else_if = {
					limit = {
						NOT = { exists = scope:director_candidate3 }
					}
					save_scope_as = director_candidate3
				}
				else = { save_scope_as = director_candidate4 }
			}

			every_in_global_list = { # ask shareholders for their vote
				variable = bank3_Shareholder

				limit = {
					#NOT = { has_character_flag = bank3_voted }
					has_variable = bank3_Shares
					var:bank3_Shares > 0
					is_alive = yes
					NOT = { this = scope:dead_director }
				}

				trigger_event = {
					id = agot_banking.0215
					days = 1
				}
			}

			random_in_global_list = { #determine election winner
				variable = bank3_Shareholder
				limit = {
					is_alive = yes
				}

				if = {
					limit = {
						has_multiple_players = no
					}
					trigger_event = {
						id = agot_banking.0225
						days = 2
					}
				}
				else = {
					trigger_event = {
						id = agot_banking.0225
						days = 6
					}
				}
			}
		}
	}
}

vassal_loan_inheritance = {
	# Vassal with active liege loan dies
	if = { #Loan inheritance
		limit = {
			has_character_flag = has_granted_liege_loan
			exists = primary_heir
			NOT = { var:vassal_loan_debtor = primary_heir }
			var:vassal_loan_debtor ?= { is_alive = yes }
		}

		save_scope_as = dead_loan_vassal

		var:vassal_loan_debtor ?= {
			set_variable = {
				name = vassal_loan_creditor
				value = scope:dead_loan_vassal.primary_heir
			}
		}

		primary_heir = {
			add_character_flag = has_granted_liege_loan
			set_variable = {
				name = liege_loan_amount
				value = scope:dead_loan_vassal.var:liege_loan_amount
			}
			set_variable = {
				name = vassal_loan_debtor
				value = scope:dead_loan_vassal.var:vassal_loan_debtor
			}
		}
	}

	# Liege with active vassal loan dies
	if = { #Loan inheritance
		limit = {
			has_character_flag = has_a_vassal_loan
			exists = primary_heir
			NOT = { var:vassal_loan_creditor = primary_heir }
			var:vassal_loan_creditor ?= { is_alive = yes }
		}

		save_scope_as = dead_loan_liege

		var:vassal_loan_creditor ?= {
			set_variable = {
				name = vassal_loan_debtor
				value = scope:dead_loan_liege.primary_heir
			}
		}

		primary_heir = {
			add_character_flag = has_a_vassal_loan
			set_variable = {
				name = vassal_loan_amount
				value = scope:dead_loan_liege.var:vassal_loan_amount
			}
			set_variable = {
				name = vassal_loan_creditor
				value = scope:dead_loan_liege.var:vassal_loan_creditor
			}
			set_variable = {
				name = vassal_loan_total_amount
				value = scope:dead_loan_liege.var:vassal_loan_total_amount
			}
			set_variable = {
				name = vassal_loan_interest
				value = scope:dead_loan_liege.var:vassal_loan_interest
			}
			trigger_event = {
				id = agot_banking.0503
				years = 5
			}
		}
	}
}

#calculate credit score and make offer
agot_credit_score_effect = {
	# Discount for shareholders
	if = {
		limit = {
			OR = {
				AND = {
					has_variable = IB_Shares
					var:IB_Shares > 0
				}
				AND = {
					has_variable = bank1_Shares
					var:bank1_Shares > 0
				}
				AND = {
					has_variable = bank2_Shares
					var:bank2_Shares > 0
				}
				AND = {
					has_variable = bank3_Shares
					var:bank3_Shares > 0
				}
			}
		}
		change_variable = {
			name = credit_score
			subtract = 2
		}
	}

	#Stewardship
	if = {
		limit = {
			stewardship < 5
		}
		change_variable = {
			name = credit_score
			add = 2
		}
	}
	else_if = {
		limit = {
			stewardship < 10
		}
		change_variable = {
			name = credit_score
			add = 1
		}
	}
	else_if = {
		limit = {
			stewardship > 15
		}
		change_variable = {
			name = credit_score
			subtract = 1
		}
	}
	else_if = {
		limit = {
			stewardship > 20
		}
		change_variable = {
			name = credit_score
			subtract = 2
		}
	}
	else_if = {
		limit = {
			stewardship > 25
		}
		change_variable = {
			name = credit_score
			subtract = 3
		}
	}

	#former default
	if = {
		limit = {
			has_character_flag = defaulted_on_loan
		}
		change_variable = {
			name = credit_score
			add = 5
		}
	}

	#bank punishment (e.g. a liege that refused to order his defaulting vassal to pay his debt)
	if = {
		limit = {
			has_character_flag = bank_punishment
		}
		change_variable = {
			name = credit_score
			add = 2
		}
	}

	#tier
	if = {
		limit = {
			highest_held_title_tier >= tier_duchy
		}
		change_variable = {
			name = credit_score
			subtract = 1
		}
	}

	#age
	if = {
		limit = {
			age >= 50
		}
		change_variable = {
			name = credit_score
			add = 1
		}
	}
	if = {
		limit = {
			age >= 60
		}
		change_variable = {
			name = credit_score
			add = 1
		}
	}
	if = {
		limit = {
			age >= 70
		}
		change_variable = {
			name = credit_score
			add = 1
		}
	}

	#war
	if = {
		limit = {
			is_at_war = yes
		}
		change_variable = {
			name = credit_score
			add = 2
		}
	}

	#prisoner
	if = {
		limit = {
			is_imprisoned = yes
		}
		change_variable = {
			name = credit_score
			add = 3
		}
	}

	#loan amount
	if = {
		limit = {
			high_loan_value > 500
		}
		change_variable = {
			name = credit_score
			add = 1
		}
	}
	if = {
		limit = {
			high_loan_value > 1000
		}
		change_variable = {
			name = credit_score
			add = 1
		}
	}

	#current cash
	if = {
		limit = {
			gold < 0
		}
		change_variable = {
			name = credit_score
			add = 1
		}
	}
	if = {
		limit = {
			gold < low_loan_value_negative
		}
		change_variable = {
			name = credit_score
			add = 1
		}
	}
	if = {
		limit = {
			gold < high_loan_value_negative
		}
		change_variable = {
			name = credit_score
			add = 2
		}
	}
	if = {
		limit = {
			gold <= very_high_debt_value
		}
		change_variable = {
			name = credit_score
			add = 15
		}
	}

	#minimum
	if = {
		limit = {
			var:credit_score < 0
		}
		set_variable = {
			name = credit_score
			value = 0
		}
	}

	#Avoid Free City election abuse
	if = {
		limit = {
			OR = {
				AND = {
					has_realm_law = free_city_election_succession_law
					highest_held_title_tier >= tier_kingdom
					NOT = { has_realm_law = term_length_life }
					NOT = { primary_title = title:k_braavos }
					NOT = { primary_title = title:k_pentos }
				}
				primary_title = title:k_myr
				primary_title = title:k_lys
				primary_title = title:k_tyrosh
			}
		}
		change_variable = {
			name = credit_score
			add = 20
		}
	}

	#Free city Magisters
	if = {
		limit = {
			AND = {
				is_governor = yes
				any_held_title = {
					tier = tier_duchy
					is_landless_type_title = no
					is_noble_family_title = no
				}
			}
		}
		change_variable = {
			name = credit_score
			add = 3
		}
	}

	#set loan condition variables
	if = {
		limit = {
			OR = {
				has_character_flag = agot_loan_high_long
				has_character_flag = agot_loan_high_short
			}
		}
		set_variable = {
			name = loaned_amount
			value = high_loan_value
		}
	}
	else = {
		set_variable = {
			name = loaned_amount
			value = low_loan_value
		}
	}

	if = {
		limit = {
			OR = {
				has_character_flag = agot_loan_high_long
				has_character_flag = agot_loan_low_long
			}
		}
		set_variable = {
			name = loan_term
			value = 10
		}
	}
	else = {
		set_variable = {
			name = loan_term
			value = 5
		}
	}

	set_variable = {
		name = loan_interest_rate
		value = 2
	}
	change_variable = {
		name = loan_interest_rate
		add = var:credit_score
	}

	# apply the banks interest level
	if = {
		limit = {
			has_character_flag = IB_debtor
		}
		change_variable = {
			name = loan_interest_rate
			add = global_var:IB_InterestLevel
		}
	}
	else_if = {
		limit = {
			has_character_flag = bank1_debtor
		}
		change_variable = {
			name = loan_interest_rate
			add = global_var:bank1_InterestLevel
		}
	}
	else_if = {
		limit = {
			has_character_flag = bank2_debtor
		}
		change_variable = {
			name = loan_interest_rate
			add = global_var:bank2_InterestLevel
		}
	}
	else_if = {
		limit = {
			has_character_flag = bank3_debtor
		}
		change_variable = {
			name = loan_interest_rate
			add = global_var:bank3_InterestLevel
		}
	}

	if = {
		limit = {
			OR = {
				AND = {
					has_character_flag = IB_debtor
					OR = {
						var:credit_score >= global_var:IB_RiskLevel
						global_var:IB_FreeCapital < var:loaned_amount
					}
				}
				AND = {
					has_character_flag = bank1_debtor
					OR = {
						var:credit_score >= global_var:bank1_RiskLevel
						global_var:bank1_FreeCapital < var:loaned_amount
					}
				}
				AND = {
					has_character_flag = bank2_debtor
					OR = {
						var:credit_score >= global_var:bank2_RiskLevel
						global_var:bank2_FreeCapital < var:loaned_amount
					}
				}
				AND = {
					has_character_flag = bank3_debtor
					OR = {
						var:credit_score >= global_var:bank3_RiskLevel
						global_var:bank3_FreeCapital < var:loaned_amount
					}
				}
			}
		}
		trigger_event = { #the bank refuses you
			id = agot_banking.0002
		}
	}
	else = {
		trigger_event = { #the bank makes an offer
			id = agot_banking.0003
		}
	}
}

historical_loan_on_game_start = {
	set_variable = {
		name = credit_score
		value = 2
	}
	set_variable = {
		name = loaned_amount
		value = 500
	}
	set_variable = {
		name = loan_term
		value = 5
	}

	add_character_flag = agot_loan_high_short
	add_character_flag = has_a_loan_flag
	add_character_flag = IB_debtor

	set_variable = {
		name = loan_interest_rate
		value = 2
	}
	change_variable = {
		name = loan_interest_rate
		add = var:credit_score
	}

	set_variable = {
		name = payable_interest
		value = var:loan_interest_rate
	}
	change_variable = {
		name = payable_interest
		divide = 100
	}
	change_variable = {
		name = payable_interest
		multiply = {
			value = var:loan_term
			multiply = var:loaned_amount
		}
	}

	set_variable = {
		name = total_repayment
		value = var:loaned_amount
	}
	change_variable = {
		name = total_repayment
		add = var:payable_interest
	}

	set_variable = {
		name = half_repayment
		value = var:total_repayment
	}
	change_variable = {
		name = half_repayment
		divide = 2
	}

	change_global_variable = {
		name = IB_FreeCapital
		subtract = var:loaned_amount
	}
	change_global_variable = {
		name = IB_LoanedCapital
		add = var:loaned_amount
	}

	add_to_global_variable_list = {
		name = IB_Important_Debtors
		target = this
	}

	create_story = {
		type = story_agot_loan
	}
}

dissolve_conquered_bank = {
	if = { # IB dissolved
		limit = {
			AND = {
				scope:title ?= {
					any_in_de_facto_hierarchy = {
						global_var:IB_location ?= this
					}
				}
				root.top_liege.primary_title = {
					any_in_de_facto_hierarchy = {
						OR = {
							global_var:bank1_location ?= this
							global_var:bank2_location ?= this
							global_var:bank3_location ?= this
						}
					}
				}
			}
		}

		root = { save_scope_as = NewHolder }
		every_in_global_list = {
			variable = IB_Shareholder

			trigger_event = { # inform shareholders and pay out remaining cash reserve
				id = agot_banking.0700
			}

			if = {
				limit = {
					has_character_flag = IB_Director
				}
				remove_character_flag = IB_Director
			}
		}

		remove_global_variable = IB_location
		remove_global_variable = IB_founder
		set_global_variable = {
			name = IB_InterestLevel
			value = 1
		}
		set_global_variable = {
			name = IB_NofDefaults
			value = 0
		}
		set_global_variable = {
			name = IB_NofLoans
			value = 0
		}
		set_global_variable = {
			name = IB_FreeCapital
			value = 0
		}
		set_global_variable = {
			name = IB_InvestmentFund
			value = 0
		}
		set_global_variable = {
			name = IB_LoanedCapital
			value = 0
		}
		set_global_variable = {
			name = IB_BankValue
			value = 0
		}
		set_global_variable = {
			name = IB_ValuePerShare
			value = 0
		}
		set_global_variable = {
			name = IB_RiskLevel
			value = 6
		}
		set_global_variable = {
			name = IB_DividendLevel
			value = 0.75
		}
		set_global_variable = {
			name = IB_Earnings
			value = 0
		}
		set_global_variable = {
			name = IB_LostLoans
			value = 0
		}
		set_global_variable = {
			name = IB_Expenses
			value = 0
		}
	}
	if = { # bank1 dissolved
		limit = {
			AND = {
				scope:title = {
					any_in_de_facto_hierarchy = {
						global_var:bank1_location ?= this
					}
				}
				root.top_liege.primary_title = {
					any_in_de_facto_hierarchy = {
						OR = {
							global_var:IB_location ?= this
							global_var:bank2_location ?= this
							global_var:bank3_location ?= this
						}
					}
				}
			}
		}

		root = { save_scope_as = NewHolder }
		every_in_global_list = {
			variable = bank1_Shareholder

			trigger_event = { # inform shareholders and pay out remaining cash reserve
				id = agot_banking.0700
			}

			if = {
				limit = {
					has_character_flag = bank1_Director
				}
				remove_character_flag = bank1_Director
			}
		}

		remove_global_variable = bank1_location
		remove_global_variable = bank1_founder
		set_global_variable = {
			name = bank1_InterestLevel
			value = 1
		}
		set_global_variable = {
			name = bank1_NofDefaults
			value = 0
		}
		set_global_variable = {
			name = bank1_NofLoans
			value = 0
		}
		set_global_variable = {
			name = bank1_FreeCapital
			value = 0
		}
		set_global_variable = {
			name = bank1_InvestmentFund
			value = 0
		}
		set_global_variable = {
			name = bank1_LoanedCapital
			value = 0
		}
		set_global_variable = {
			name = bank1_BankValue
			value = 0
		}
		set_global_variable = {
			name = bank1_ValuePerShare
			value = 0
		}
		set_global_variable = {
			name = bank1_RiskLevel
			value = 6
		}
		set_global_variable = {
			name = bank1_DividendLevel
			value = 0.75
		}
		set_global_variable = {
			name = bank1_Earnings
			value = 0
		}
		set_global_variable = {
			name = bank1_LostLoans
			value = 0
		}
		set_global_variable = {
			name = bank1_Expenses
			value = 0
		}
	}
	if = { # bank2 dissolved
		limit = {
			AND = {
				scope:title = {
					any_in_de_facto_hierarchy = {
						global_var:bank2_location ?= this
					}
				}
				root.top_liege.primary_title = {
					any_in_de_facto_hierarchy = {
						OR = {
							global_var:IB_location ?= this
							global_var:bank1_location ?= this
							global_var:bank3_location ?= this
						}
					}
				}
			}
		}

		root = { save_scope_as = NewHolder }
		every_in_global_list = {
			variable = bank2_Shareholder

			trigger_event = { # inform shareholders and pay out remaining cash reserve
				id = agot_banking.0700
			}

			if = {
				limit = {
					has_character_flag = bank2_Director
				}
				remove_character_flag = bank2_Director
			}
		}

		remove_global_variable = bank2_location
		remove_global_variable = bank2_founder
		set_global_variable = {
			name = bank2_InterestLevel
			value = 1
		}
		set_global_variable = {
			name = bank2_NofDefaults
			value = 0
		}
		set_global_variable = {
			name = bank2_NofLoans
			value = 0
		}
		set_global_variable = {
			name = bank2_FreeCapital
			value = 0
		}
		set_global_variable = {
			name = bank2_InvestmentFund
			value = 0
		}
		set_global_variable = {
			name = bank2_LoanedCapital
			value = 0
		}
		set_global_variable = {
			name = bank2_BankValue
			value = 0
		}
		set_global_variable = {
			name = bank2_ValuePerShare
			value = 0
		}
		set_global_variable = {
			name = bank2_RiskLevel
			value = 6
		}
		set_global_variable = {
			name = bank2_DividendLevel
			value = 0.75
		}
		set_global_variable = {
			name = bank2_Earnings
			value = 0
		}
		set_global_variable = {
			name = bank2_LostLoans
			value = 0
		}
		set_global_variable = {
			name = bank2_Expenses
			value = 0
		}
	}
	if = { # bank3 dissolved
		limit = {
			AND = {
				scope:title = {
					any_in_de_facto_hierarchy = {
						global_var:bank3_location ?= this
					}
				}
				root.top_liege.primary_title = {
					any_in_de_facto_hierarchy = {
						OR = {
							global_var:IB_location ?= this
							global_var:bank1_location ?= this
							global_var:bank2_location ?= this
						}
					}
				}
			}
		}

		root = { save_scope_as = NewHolder }
		every_in_global_list = {
			variable = bank3_Shareholder

			trigger_event = { # inform shareholders and pay out remaining cash reserve
				id = agot_banking.0700
			}

			if = {
				limit = {
					has_character_flag = bank3_Director
				}
				remove_character_flag = bank3_Director
			}
		}

		remove_global_variable = bank3_location
		remove_global_variable = bank3_founder
		set_global_variable = {
			name = bank3_InterestLevel
			value = 1
		}
		set_global_variable = {
			name = bank3_NofDefaults
			value = 0
		}
		set_global_variable = {
			name = bank3_NofLoans
			value = 0
		}
		set_global_variable = {
			name = bank3_FreeCapital
			value = 0
		}
		set_global_variable = {
			name = bank3_InvestmentFund
			value = 0
		}
		set_global_variable = {
			name = bank3_LoanedCapital
			value = 0
		}
		set_global_variable = {
			name = bank3_BankValue
			value = 0
		}
		set_global_variable = {
			name = bank3_ValuePerShare
			value = 0
		}
		set_global_variable = {
			name = bank3_RiskLevel
			value = 6
		}
		set_global_variable = {
			name = bank3_DividendLevel
			value = 0.75
		}
		set_global_variable = {
			name = bank3_Earnings
			value = 0
		}
		set_global_variable = {
			name = bank3_LostLoans
			value = 0
		}
		set_global_variable = {
			name = bank3_Expenses
			value = 0
		}
	}
}

dissolve_bankrupt_bank = {
	if = { # IB dissolved
		limit = {
			has_character_flag = IB_dissolver
		}

		every_in_global_list = {
			variable = IB_Shareholder

			trigger_event = { # inform shareholders and clear share variable
				id = agot_banking.0803
			}
		}

		remove_global_variable = IB_location
		remove_global_variable = IB_founder
		set_global_variable = {
			name = IB_InterestLevel
			value = 1
		}
		set_global_variable = {
			name = IB_NofDefaults
			value = 0
		}
		set_global_variable = {
			name = IB_NofLoans
			value = 0
		}
		set_global_variable = {
			name = IB_FreeCapital
			value = 0
		}
		set_global_variable = {
			name = IB_InvestmentFund
			value = 0
		}
		set_global_variable = {
			name = IB_LoanedCapital
			value = 0
		}
		set_global_variable = {
			name = IB_BankValue
			value = 0
		}
		set_global_variable = {
			name = IB_ValuePerShare
			value = 0
		}
		set_global_variable = {
			name = IB_RiskLevel
			value = 6
		}
		set_global_variable = {
			name = IB_DividendLevel
			value = 0.75
		}
		set_global_variable = {
			name = IB_Earnings
			value = 0
		}
		set_global_variable = {
			name = IB_LostLoans
			value = 0
		}
		set_global_variable = {
			name = IB_Expenses
			value = 0
		}
		set_global_variable = {
			name = IB_NofShares
			value = 0
		}
	}
	else_if = { # bank1 dissolved
		limit = {
			has_character_flag = bank1_dissolver
		}

		every_in_global_list = {
			variable = bank1_Shareholder

			trigger_event = { # inform shareholders and clear share variable
				id = agot_banking.0803
			}
		}

		remove_global_variable = bank1_location
		remove_global_variable = bank1_founder
		set_global_variable = {
			name = bank1_InterestLevel
			value = 1
		}
		set_global_variable = {
			name = bank1_NofDefaults
			value = 0
		}
		set_global_variable = {
			name = bank1_NofLoans
			value = 0
		}
		set_global_variable = {
			name = bank1_FreeCapital
			value = 0
		}
		set_global_variable = {
			name = bank1_InvestmentFund
			value = 0
		}
		set_global_variable = {
			name = bank1_LoanedCapital
			value = 0
		}
		set_global_variable = {
			name = bank1_BankValue
			value = 0
		}
		set_global_variable = {
			name = bank1_ValuePerShare
			value = 0
		}
		set_global_variable = {
			name = bank1_RiskLevel
			value = 6
		}
		set_global_variable = {
			name = bank1_DividendLevel
			value = 0.75
		}
		set_global_variable = {
			name = bank1_Earnings
			value = 0
		}
		set_global_variable = {
			name = bank1_LostLoans
			value = 0
		}
		set_global_variable = {
			name = bank1_Expenses
			value = 0
		}
		set_global_variable = {
			name = bank1_NofShares
			value = 0
		}
	}
	else_if = { # bank2 dissolved
		limit = {
			has_character_flag = bank2_dissolver
		}

		every_in_global_list = {
			variable = bank2_Shareholder

			trigger_event = { # inform shareholders and clear share variable
				id = agot_banking.0803
			}
		}

		remove_global_variable = bank2_location
		remove_global_variable = bank2_founder
		set_global_variable = {
			name = bank2_InterestLevel
			value = 1
		}
		set_global_variable = {
			name = bank2_NofDefaults
			value = 0
		}
		set_global_variable = {
			name = bank2_NofLoans
			value = 0
		}
		set_global_variable = {
			name = bank2_FreeCapital
			value = 0
		}
		set_global_variable = {
			name = bank2_InvestmentFund
			value = 0
		}
		set_global_variable = {
			name = bank2_LoanedCapital
			value = 0
		}
		set_global_variable = {
			name = bank2_BankValue
			value = 0
		}
		set_global_variable = {
			name = bank2_ValuePerShare
			value = 0
		}
		set_global_variable = {
			name = bank2_RiskLevel
			value = 6
		}
		set_global_variable = {
			name = bank2_DividendLevel
			value = 0.75
		}
		set_global_variable = {
			name = bank2_Earnings
			value = 0
		}
		set_global_variable = {
			name = bank2_LostLoans
			value = 0
		}
		set_global_variable = {
			name = bank2_Expenses
			value = 0
		}
		set_global_variable = {
			name = bank2_NofShares
			value = 0
		}
	}
	else_if = { # bank3 dissolved
		limit = {
			has_character_flag = bank3_dissolver
		}

		every_in_global_list = {
			variable = bank3_Shareholder

			trigger_event = { # inform shareholders and clear share variable
				id = agot_banking.0803
			}
		}

		remove_global_variable = bank3_location
		remove_global_variable = bank3_founder
		set_global_variable = {
			name = bank3_InterestLevel
			value = 1
		}
		set_global_variable = {
			name = bank3_NofDefaults
			value = 0
		}
		set_global_variable = {
			name = bank3_NofLoans
			value = 0
		}
		set_global_variable = {
			name = bank3_FreeCapital
			value = 0
		}
		set_global_variable = {
			name = bank3_InvestmentFund
			value = 0
		}
		set_global_variable = {
			name = bank3_LoanedCapital
			value = 0
		}
		set_global_variable = {
			name = bank3_BankValue
			value = 0
		}
		set_global_variable = {
			name = bank3_ValuePerShare
			value = 0
		}
		set_global_variable = {
			name = bank3_RiskLevel
			value = 6
		}
		set_global_variable = {
			name = bank3_DividendLevel
			value = 0.75
		}
		set_global_variable = {
			name = bank3_Earnings
			value = 0
		}
		set_global_variable = {
			name = bank3_LostLoans
			value = 0
		}
		set_global_variable = {
			name = bank3_Expenses
			value = 0
		}
		set_global_variable = {
			name = bank3_NofShares
			value = 0
		}
	}
}