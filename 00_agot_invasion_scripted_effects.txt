traditional_targaryen_loyalist_alliance_effect = {
	dynasty:dynn_Hayford.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Goodbrook.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Rowan.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Oakheart.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Tarly.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Hightower.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Hasty.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Lonmouth.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Rykker.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Ashford.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Boggs.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Brune.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Bush.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Pyne.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Hardy.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Cave.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Crabb.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Celtigar.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Velaryon.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Massey.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Mooton.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Butterwell.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Vyrwel.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Hersy.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Darry.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Martell.dynast = {
		add_to_list = potential_allies
	}
	every_in_list = {
		list = potential_allies
		limit = {
			is_alive = yes
			is_landed = yes
			is_ai = yes
			NOT = {
				invader_ally_builder_trigger = {
					INVADER = root
					TITLE_HOLDER = title:e_the_iron_throne.holder
				}
			}
		}
		set_variable = {
			name = targ_loyalist_story_content_ally
			value = root
		}
		save_temporary_scope_as = ally
		root = {
			create_alliance = {
				target = scope:ally
				allied_through_owner = root
				allied_through_target = scope:ally
			}
		}
		hidden_effect = {
			add_opinion = {
				target = root
				modifier = event_negotiated_alliance_opinion
			}
		}
	}
}
agot_invasions_move_to_new_court = {
	if = {
		limit = {
			has_character_flag = exiled_from_westeros
			$NEW_LIEGE$ = {
				primary_title = {
					title_capital_county.title_province = {
						geographical_region = world_westeros_seven_kingdoms
					}
				}
			}
		}
		remove_character_flag = exiled_from_westeros
		if = {
			limit = {
				any_courtier = {
					has_character_flag = exiled_from_westeros
				}
			}
			every_courtier = {
				limit = {
					has_character_flag = exiled_from_westeros
				}
				remove_character_flag = exiled_from_westeros
			}
		}
	}
	hidden_effect = {
		every_courtier = {
			set_employer = $NEW_LIEGE$
			return_to_court = yes
		}
	}
	destroy_title = primary_title
	hidden_effect = {
		set_employer = $NEW_LIEGE$
		return_to_court = yes
	}
	if = {
		limit = {
			is_ai = no
		}
		set_player_character = $NEW_LIEGE$
	}
	if = {
		limit = {
			has_targaryen_exile_story = yes
		}
		hidden_effect = {
			random_owned_story = {
				limit = {
					story_type = story_agot_targaryen_exile_invasion
				}
				end_story = yes
			}
		}
	}
}
traditional_blackfyre_loyalist_alliance_effect = {
	dynasty:dynn_Peake.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Ball.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Yronwood.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Bracken.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Sunderland.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Osgrey.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Costayne.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Shawney.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Butterwell.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Oakheart.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	dynasty:dynn_Hightower.dynasty_founder.house.house_head ?= {
		add_to_list = potential_allies
	}
	every_in_list = {
		list = potential_allies
		limit = {
			is_alive = yes
			is_landed = yes
			is_ai = yes
			NOT = {
				invader_ally_builder_trigger = {
					INVADER = root
					TITLE_HOLDER = title:e_the_iron_throne.holder
				}
			}
		}
		set_variable = {
			name = blackfyre_loyalist_story_content_ally
			value = root
		}
		save_temporary_scope_as = ally
		root = {
			create_alliance = {
				target = scope:ally
				allied_through_owner = root
				allied_through_target = scope:ally
			}
		}
		hidden_effect = {
			add_opinion = {
				target = root
				modifier = event_negotiated_alliance_opinion
			}
		}
	}
}
agot_purge_and_convert_targ_and_blackfyre_scripted_alliances = {
	every_ally = {
		limit = {
			var:$VARIABLE_NAME$ ?= root
			opinion = {
				target = root
				value < high_positive_opinion
			}
		}
		remove_variable = $VARIABLE_NAME$
		break_alliance = root
		add_truce_both_ways = {
			character = root
			days = 365
			name = targ_exiles_and_faegon_truce_name
		}
	}
}
agot_invasions_remove_story_modifiers = {
	if = {
		limit = {
			has_character_modifier = agot_exile_faegon_invader_embark_modifier
		}
		remove_character_modifier = agot_exile_faegon_invader_embark_modifier
	}
}
agot_faegon_lost_or_invalidated_war_but_can_reclaim_identity_effect = {
	if = {
		limit = {
			var:identity ?= flag:alleged_real_aegon
		}
		set_variable = {
			name = faegon_can_reclaim_identity
			value = yes
		}
	}
}
faegon_has_taken_throne_or_become_king_effect = {
	if = {
		limit = {
			has_trait = refusing_marriage
		}
		remove_trait = refusing_marriage
	}
	character:Mopatis_1 = {
		save_scope_as = illyrio
	}
	if = {
		limit = {
			NOT = {
				has_variable = faegon_can_reclaim_identity
			}
			var:identity = flag:open_blackfyre
			scope:illyrio = {
				is_ai = yes
				is_alive = yes
				any_character_artifact = {
					has_variable = dragon_egg
				}
			}
		}
		random_list = {
			20 = {}
			80 = {
				every_character_artifact = {
					limit = {
						has_variable = dragon_egg
					}
					set_owner = root
				}
			}
		}
	}
	if = {
		limit = {
			var:identity = flag:alleged_real_aegon
		}
		set_mother = character:Martell_7
		set_father = character:Targaryen_3
		set_house = character:Targaryen_3.house
		hidden_effect = {
			create_character = {
				template = peasant_character
				age = 50
				gender = female
				culture = root.culture
				faith = root.faith
				location = root.location
				save_scope_as = peasant1
			}
			create_character = {
				template = peasant_character
				age = 50
				gender = male
				culture = root.culture
				faith = root.faith
				location = root.location
				save_scope_as = peasant2
			}
			character:Targaryen_11 = {
				set_father = scope:peasant2
				set_mother = scope:peasant1
				set_to_lowborn = yes
			}
		}
	}
}

agot_invasions_restore_or_grant_it_claims = {
	if = {
		limit = {
			NOT = {
				has_claim_on = title:e_the_iron_throne
			}
		}
		add_pressed_claim = title:e_the_iron_throne
	}
	if = {
		limit = {
			NOT = {
				has_claim_on = title:k_the_crownlands
			}
		}
		add_pressed_claim = title:k_the_crownlands
	}
	if = {
		limit = {
			NOT = {
				has_claim_on = title:d_kings_landing
			}
		}
		add_pressed_claim = title:d_kings_landing
	}
	if = {
		limit = {
			NOT = {
				has_claim_on = title:c_kings_landing
			}
		}
		add_pressed_claim = title:c_kings_landing
	}
	if = {
		limit = {
			NOT = {
				has_claim_on = title:k_dragonstone
			}
		}
		add_pressed_claim = title:k_dragonstone
	}
	if = {
		limit = {
			NOT = {
				has_claim_on = title:d_dragonstone
			}
		}
		add_pressed_claim = title:d_dragonstone
	}
	if = {
		limit = {
			NOT = {
				has_claim_on = title:c_dragonstone
			}
		}
		add_pressed_claim = title:c_dragonstone
	}
}

agot_invaders_dragonstone_transfer_effect = {
	if = {
		limit = {
			title:k_dragonstone.holder != $RECIPIENT$
		}
		title:k_dragonstone = {
			add_to_list = titles
		}
	}
	if = {
		limit = {
			title:d_dragonstone.holder != $RECIPIENT$
		}
		title:d_dragonstone = {
			add_to_list = titles
		}
	}
	if = {
		limit = {
			title:c_dragonstone.holder != $RECIPIENT$
		}
		title:c_dragonstone = {
			add_to_list = titles
		}
	}
	if = {
		limit = {
			list_size:titles > 0
		}
		hidden_effect = {
			create_title_and_vassal_change = {
				type = conquest
				save_scope_as = change
				add_claim_on_loss = yes
			}
			every_in_list = {
				list = titles
				change_title_holder_include_vassals = {
					holder = $RECIPIENT$
					change = scope:change
				}
			}
			resolve_title_and_vassal_change = scope:change
		}
	}
}